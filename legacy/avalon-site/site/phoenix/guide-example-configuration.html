<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--*** This is a generated file.  Do not edit.  ***-->
<link rel="stylesheet" href="skin/tigris.css" type="text/css">
<link rel="stylesheet" href="skin/mysite.css" type="text/css">
<link rel="stylesheet" href="skin/site.css" type="text/css">
<link media="print" rel="stylesheet" href="skin/print.css" type="text/css">
<title>Guide - Example Configuration</title>
</head>
<body bgcolor="white" class="composite">
<!--================= start Banner ==================-->
<div id="banner">
<table width="100%" cellpadding="8" cellspacing="0" summary="banner" border="0">
<tbody>
<tr>
<!--================= start Group Logo ==================-->
<td align="left">
<div class="groupLogo">
<a href="http://avalon.apache.org/"><img border="0" class="logoImage" alt="Apache Avalon-Phoenix" src="images/apache-avalon-logo.png"></a>
</div>
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td align="right">
<div class="projectLogo">
<a href="http://apachecon.com/2003/US/index.html"><img border="0" class="logoImage" alt="Visit ApacheCon 2003!" src="http://www.apache.org/~ceki/ac2003/ac2003-150.gif"></a>
</div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</tbody>
</table>
</div>
<!--================= end Banner ==================-->
<!--================= start Main ==================-->
<table width="100%" cellpadding="0" cellspacing="0" border="0" summary="nav" id="breadcrumbs">
<tbody>
<!--================= start Status ==================-->
<tr class="status">
<td>
<!--================= start BreadCrumb ==================--><a href="http://www.apache.org/">Apache Main</a> | <a href="http://avalon.apache.org/">Avalon Main</a> | <a href="../">Up</a>
<!--================= end BreadCrumb ==================--></td><td id="tabs">
<!--================= start Tabs ==================-->
<div class="tab">
<span class="unselectedTab"><a href="http://www.apache.org/">Apache</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/">Avalon</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/framework/">Framework</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/containers/">Containers</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/components/">Components</a></span>
</div>
<!--================= end Tabs ==================-->
</td>
</tr>
</tbody>
</table>
<!--================= end Status ==================-->
<table id="main" width="100%" cellpadding="8" cellspacing="0" summary="" border="0">
<tbody>
<tr valign="top">
<!--================= start Menu ==================-->
<td id="leftcol">
<div id="navcolumn">
<div class="menuBar">
<div class="menu">
<span class="menuLabel">Essentials</span>
        
<div class="menuItem">
<a href="index.html">Overview</a>
</div>
        
<div class="menuItem">
<a href="features.html">Features</a>
</div>
        
<div class="menuItem">
<a href="getting-started.html">Getting started</a>
</div>
        
<div class="menuItem">
<a href="http://avalon.apache.org/bindownload.cgi">Download</a>
</div>
        
<div class="menuItem">
<a href="install.html">Install</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Guide</span>
        
<div class="menuItem">
<a href="guide-architecture.html">Architectural Overview</a>
</div>
        
<div class="menuItem">
<a href="guide-roles.html">Development Roles</a>
</div>
        
<div class="menuItem">
<a href="guide-administrator.html">for Administrators</a>
</div>
        
<div class="menuItem">
<a href="guide-deployers.html">for Deployers</a>
</div>
        
<div class="menuItem">
<a href="assemblers/index.html">for Assemblers</a>
</div>
        
<div class="menuItem">
<a href="bdg/index.html">for Block Developers</a>
</div>
        
<div class="menuItem">
<a href="mx/index.html">Management Guide</a>
</div>
        
<div class="menuItem">
<span class="menuSelected">Example configuration</span>
</div>
        
<div class="menuItem">
<a href="guide-punit.html">PUnit unit testing</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Reference</span>
        
<div class="menuItem">
<a href="api/index.html">API Docs</a>
</div>
        
<div class="menuItem">
<a href="assemblers/config-xml-specification.html">config.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="assemblers/assembly-xml-specification.html">assembly.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="assemblers/environment-xml-specification.html">environment.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="bdg/blockinfo-specification.html">BlockInfo Specification</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">For Developers</span>
        
<div class="menuItem">
<a href="changes.html">Changes</a>
</div>
        
<div class="menuItem">
<a href="http://avalon.apache.org/code-standards.html">Coding standards</a>
</div>
        
<div class="menuItem">
<a href="for-developers-project-structure.html">Project Structure</a>
</div>
        
<div class="menuItem">
<a href="http://jakarta.apache.org/site/cvsindex.html">CVS Repositories</a>
</div>
        
<div class="menuItem">
<a href="http://jakarta.apache.org/site/mail.html">Mailing Lists</a>
</div>
        
<div class="menuItem">
<a href="http://nagoya.apache.org/bugzilla/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&bug_status=RESOLVED&product=Avalon&component=Phoenix">TODO</a>
</div>
        
<div class="menuItem">
<a href="http://jira.werken.com/secure/BrowseProject.jspa?id=10081">Issue Tracker (Bug and Enhancement List)</a>
</div>
        
<div class="menuItem">
<a href="for-developers-alternate-kernel.html">Alternate Kernels</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Links</span>
        
<div class="menuItem">
<a href="applications.html">Applications</a>
</div>
    
</div>
</div>
</div>
</td>
<!--================= end Menu ==================-->
<!--================= start Content ==================--><td>
<div id="bodycol">
<div class="app">
<div align="center">
<h1>Guide - Example Configuration</h1>
</div>
<div class="h3">
  
  
    
<div class="h3">
<h3>Introduction</h3>
</div>
      
<p>This page contains a real production example of a block
      assembly and block .xinfo description based an extract from
      a B2B Enterprise Integration and Collaboration Platform developed by
      <a href="http://www.osm.net">OSM</a>.</p>
      
<p>This example was originally a Mailing List response to a
      some user questions!</p>
      
<p>The orginal post was written by Stephen McConnell from OSM.</p>
    
    
<div class="h3">
<h3>The example</h3>
</div>
      
<p>Each Block has an associated xinfo file and the xinfo file
      is stored alongside the block in a jar file. The <span class="codefrag">.xinfo</span>
      file contains a description of a reasonably simple block that serves
      as a factory for business processes that handle PKI certification
      requests:</p>
      
<pre class="code">
&lt;?xml version="1.0"?&gt;

&lt;blockinfo&gt;
&lt;block&gt;
    &lt;version&gt;1.0&lt;/version&gt;
  &lt;/block&gt;

  &lt;services&gt;
      &lt;!--
      This block could be declaring several services that it supports.
      Unlike a Java interface, the service includes a version tag. So
      it's possible for a block to have several services with possibly
      different versions. If there are multiple services then just
      declare them with multiple service entries here. Phoenix will make
      sure that the class with the same name as the .xinfo file
      implements these interfaces (if it doesn't then Phoenix will
      terminate).
      --&gt;
      &lt;service name="org.apache.acme.hub.gateway.FactoryService"/&gt;
  &lt;/services&gt;

  &lt;!--
  So far, we have the definition of a class that supports possibly
  multiple version interfaces. But things get much more interesting, when
  we think about the services that this block requires in order to function
  properly. That's partly handled by the dependencies element and partly by
  the assembly.xml file (which I'll explain later). In the following
  dependency example there are seven "service" dependencies (i.e. 7 versioned
  interface dependencies that must be fulfilled for this block to function.
  --&gt;

  &lt;dependencies&gt;
      &lt;!--
      Each dependency contains a declaration of a role name and a service
      interface and a version that can fulfil that role. The dependency
      does not say anything about where that service implementation should
      come from (that's the job the assembly.xml file). The role element
      is simply the label used in the implementation of your block configure
      method that distinguishes a particular instance of the service.
      --&gt;
      &lt;dependency&gt;
          &lt;role&gt;GATEWAY&lt;/role&gt;
          &lt;service name="org.apache.acme.hub.gateway.GatewayContext"/&gt;
      &lt;/dependency&gt;

      &lt;!--
      This dependency declaration simply states that in order to function,
      this block requires a &lt;service/&gt; (in this case a wrapper to a CORBA
      ORB version 2.4) and that the block implementation will lookup this
      service using the "ORB" keyword.
      --&gt;
      &lt;dependency&gt;
          &lt;role&gt;ORB&lt;/role&gt;
          &lt;service name="org.apache.acme.hub.gateway.ORBService"
                   version="2.4"/&gt;
      &lt;/dependency&gt;

      &lt;!--
      This dependency declares a requirement for a PSS (Persistent State
      Service) Storage Home.
      --&gt;
      &lt;dependency&gt;
          &lt;role&gt;PSS&lt;/role&gt;
          &lt;service name="org.apache.acme.hub.gateway.ProcessorStorageHomeService"/&gt;
      &lt;/dependency&gt;

      &lt;!--
      This dependency enables the block to establish a call-back to the
      block supplying the service. This block uses the Registry interface
      to publish a business process description to a higher level manager.
      --&gt;
      &lt;dependency&gt;
          &lt;role&gt;REGISTRY&lt;/role&gt;
          &lt;service name="org.apache.acme.hub.gateway.Registry"/&gt;
      &lt;/dependency&gt;

      &lt;!-- etc. --&gt;
      &lt;dependency&gt;
          &lt;role&gt;DOMAIN&lt;/role&gt;
          &lt;service name="org.apache.acme.hub.gateway.DomainService"/&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;role&gt;RANDOM&lt;/role&gt;
          &lt;service name="org.apache.acme.hub.gateway.RandomService"/&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
          &lt;role&gt;CLOCK&lt;/role&gt;
          &lt;service name="org.apache.acme.service.time.TimeService"/&gt;
      &lt;/dependency&gt;

  &lt;/dependencies&gt;

&lt;/blockinfo&gt;

      
      </pre>
      
<p>Next is the block declaration (an extract from an <span class="codefrag">assembly.xml</span>
      file). This enables the declaration of WHERE the services are coming from.
      I.e. you may have a system with many blocks and even the potential for matching
      services available from more that one block. The class attribute provides the
      link to the <span class="codefrag">.xinfo</span> file and the implementation class. The name
      is used a key within the <span class="codefrag">assembly.xml</span> file when wiring things together.
      E.g. the provide element references a block by its name - and declares that the
      named block will serve as the provider of the service. The role attribute matches
      the role element in the <span class="codefrag">.xinfo</span> dependency declaration.</p>
      
<p>The name attribute also serves a the key to lookup a configuration element in
      the application configuration.xml file.</p>
      
<pre class="code">
&lt;?xml version="1.0"?&gt;

&lt;assembly&gt;

  &lt;!-- other assembly information here --&gt;

  &lt;!-- Certification Request Processor Factory --&gt;
  &lt;block class="org.apache.acme.pki.process.CertificationRequestServer"
         name="certification" &gt;
    &lt;provide name="gateway" role="GATEWAY"/&gt;
    &lt;provide name="gateway" role="ORB"/&gt;
    &lt;provide name="gateway" role="PSS"/&gt;
    &lt;provide name="gateway" role="DOMAIN"/&gt;
    &lt;provide name="gateway" role="RANDOM"/&gt;
    &lt;provide name="pki" role="REGISTRY"/&gt;
    &lt;provide name="time" role="CLOCK"/&gt;
  &lt;/block&gt;

  &lt;!-- more assembly information here --&gt;

&lt;/assembly&gt;
      
      </pre>
    
<div class="h4">
<h4></h4>
</div>

    
<div class="h4">
<h4>Why this seperation?</h4>
</div>
    
<ul>
      
<li>It forces structure and separation</li>
      
<li>It provides a way of managing possibly multiple versions of the
          same interface in a single environment</li>
      
<li>It enables explicit declaration of the source of service provision</li>
    
</ul>

    
<p>For example you can have multiple blocks providing a TimeService.
    One of those blocks uses an external time reference while the others
    use a local time reference. The local time block
    declare dependencies on the external source time block and is periodically
    synchronised. In this example all of the TimeService services are exposing
    the same interface, same version (i.e. same service), but the decision as to
    which service is the provider to another can  be explicitly controlled.
    While the time example is perhaps trivial, there are significant policy
    security implications related to service provider selection.</p>
    
  

<div id="authors" align="right">by&nbsp;Stephen McConnell,&nbsp;Gerhard Froehlich</div>
</div>
</div>
</div>
</td>
<!--================= end Content ==================-->
</tr>
</tbody>
</table>
<!--================= end Main ==================-->
<!--================= start Footer ==================-->
<div id="footer">
<table summary="footer" cellspacing="0" cellpadding="4" width="100%" border="0">
<tbody>
<tr>
<!--================= start Copyright ==================-->
<td colspan="2">
<div align="center">
<div class="copyright">
              Copyright &copy; 2002-2003&nbsp;The Apache Software Foundation.. All rights reserved.
            </div>
</div>
</td>
<!--================= end Copyright ==================-->
</tr>
<tr>
<td align="left">
<!--================= start Host ==================-->
<!--================= end Host ==================--></td><td align="right">
<!--================= start Credits ==================-->
<div align="right">
<div class="credit"></div>
</div>
<!--================= end Credits ==================-->
</td>
</tr>
</tbody>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
