<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--*** This is a generated file.  Do not edit.  ***-->
<link rel="stylesheet" href="skin/tigris.css" type="text/css">
<link rel="stylesheet" href="skin/mysite.css" type="text/css">
<link rel="stylesheet" href="skin/site.css" type="text/css">
<link media="print" rel="stylesheet" href="skin/print.css" type="text/css">
<title>Guide - PUnit</title>
</head>
<body bgcolor="white" class="composite">
<!--================= start Banner ==================-->
<div id="banner">
<table width="100%" cellpadding="8" cellspacing="0" summary="banner" border="0">
<tbody>
<tr>
<!--================= start Group Logo ==================-->
<td align="left">
<div class="groupLogo">
<a href="http://avalon.apache.org/"><img border="0" class="logoImage" alt="Apache Avalon-Phoenix" src="images/apache-avalon-logo.png"></a>
</div>
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td align="right">
<div class="projectLogo">
<a href="http://apachecon.com/2003/US/index.html"><img border="0" class="logoImage" alt="Visit ApacheCon 2003!" src="http://www.apache.org/~ceki/ac2003/ac2003-150.gif"></a>
</div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</tbody>
</table>
</div>
<!--================= end Banner ==================-->
<!--================= start Main ==================-->
<table width="100%" cellpadding="0" cellspacing="0" border="0" summary="nav" id="breadcrumbs">
<tbody>
<!--================= start Status ==================-->
<tr class="status">
<td>
<!--================= start BreadCrumb ==================--><a href="http://www.apache.org/">Apache Main</a> | <a href="http://avalon.apache.org/">Avalon Main</a> | <a href="../">Up</a>
<!--================= end BreadCrumb ==================--></td><td id="tabs">
<!--================= start Tabs ==================-->
<div class="tab">
<span class="unselectedTab"><a href="http://www.apache.org/">Apache</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/">Avalon</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/framework/">Framework</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/containers/">Containers</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/components/">Components</a></span>
</div>
<!--================= end Tabs ==================-->
</td>
</tr>
</tbody>
</table>
<!--================= end Status ==================-->
<table id="main" width="100%" cellpadding="8" cellspacing="0" summary="" border="0">
<tbody>
<tr valign="top">
<!--================= start Menu ==================-->
<td id="leftcol">
<div id="navcolumn">
<div class="menuBar">
<div class="menu">
<span class="menuLabel">Essentials</span>
        
<div class="menuItem">
<a href="index.html">Overview</a>
</div>
        
<div class="menuItem">
<a href="features.html">Features</a>
</div>
        
<div class="menuItem">
<a href="getting-started.html">Getting started</a>
</div>
        
<div class="menuItem">
<a href="http://avalon.apache.org/bindownload.cgi">Download</a>
</div>
        
<div class="menuItem">
<a href="install.html">Install</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Guide</span>
        
<div class="menuItem">
<a href="guide-architecture.html">Architectural Overview</a>
</div>
        
<div class="menuItem">
<a href="guide-roles.html">Development Roles</a>
</div>
        
<div class="menuItem">
<a href="guide-administrator.html">for Administrators</a>
</div>
        
<div class="menuItem">
<a href="guide-deployers.html">for Deployers</a>
</div>
        
<div class="menuItem">
<a href="assemblers/index.html">for Assemblers</a>
</div>
        
<div class="menuItem">
<a href="bdg/index.html">for Block Developers</a>
</div>
        
<div class="menuItem">
<a href="mx/index.html">Management Guide</a>
</div>
        
<div class="menuItem">
<a href="guide-example-configuration.html">Example configuration</a>
</div>
        
<div class="menuItem">
<span class="menuSelected">PUnit unit testing</span>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Reference</span>
        
<div class="menuItem">
<a href="api/index.html">API Docs</a>
</div>
        
<div class="menuItem">
<a href="assemblers/config-xml-specification.html">config.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="assemblers/assembly-xml-specification.html">assembly.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="assemblers/environment-xml-specification.html">environment.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="bdg/blockinfo-specification.html">BlockInfo Specification</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">For Developers</span>
        
<div class="menuItem">
<a href="changes.html">Changes</a>
</div>
        
<div class="menuItem">
<a href="http://avalon.apache.org/code-standards.html">Coding standards</a>
</div>
        
<div class="menuItem">
<a href="for-developers-project-structure.html">Project Structure</a>
</div>
        
<div class="menuItem">
<a href="http://jakarta.apache.org/site/cvsindex.html">CVS Repositories</a>
</div>
        
<div class="menuItem">
<a href="http://jakarta.apache.org/site/mail.html">Mailing Lists</a>
</div>
        
<div class="menuItem">
<a href="http://nagoya.apache.org/bugzilla/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&bug_status=RESOLVED&product=Avalon&component=Phoenix">TODO</a>
</div>
        
<div class="menuItem">
<a href="http://jira.werken.com/secure/BrowseProject.jspa?id=10081">Issue Tracker (Bug and Enhancement List)</a>
</div>
        
<div class="menuItem">
<a href="for-developers-alternate-kernel.html">Alternate Kernels</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Links</span>
        
<div class="menuItem">
<a href="applications.html">Applications</a>
</div>
    
</div>
</div>
</div>
</td>
<!--================= end Menu ==================-->
<!--================= start Content ==================--><td>
<div id="bodycol">
<div class="app">
<div align="center">
<h1>Guide - PUnit</h1>
</div>
<div class="h3">
  
  
    
<div class="h3">
<h3>Introduction</h3>
</div>
      
<p>
        Phoenix has a component/lifecycle aware unit test framework called PUnit.  It has no requirements on 
        external meta information.  As such it could be used for unit testing for a wide range of Avalon-Framework 
        enabled components.  Having said that, usage requires some knowledge of multi component applications and
        the order of component lifecycling. PUnit builds on JUnit.  You should have testing experience of 
        <a href="http://www.junit.org">JUnit</a> before using PUnit.
      </p>
    
    
<div class="h3">
<h3>Example Usage</h3>
</div>
      
<p>
        There is a unit test framework for Phoenix called PUnit.  It is used for pseudo in-container testing of Phoenix 
        components.  The main class PUnitTestCase should be extended by the developer, some manual setup done, then 
        normal assertXXX() testing.
      </p>
      
<p>
<strong>Test component (from Phoenix's own PUnit TestCase)</strong>
</p>      
      
<pre class="code">
public class TestBlock
        implements Serviceable, Configurable, Initializable, Contextualizable, LogEnabled
{

    public ServiceManager m_serviceManager;
    public boolean m_initialized;
    public Context m_context;
    public Logger m_logger;
    public Configuration m_configuration;

    public void service( final ServiceManager serviceManager ) throws ServiceException
    {
        m_logger.info("service");
        m_serviceManager = serviceManager;
    }

    public void initialize() throws Exception
    {
        m_logger.warn("initialize");
        m_initialized = true;
    }

    public void contextualize(Context context) throws ContextException
    {
        m_logger.error("contextualize");
        m_context = context;
    }

    public void enableLogging(Logger logger)
    {
        m_logger = logger;
    }

    public void configure(Configuration configuration) throws ConfigurationException
    {
        m_logger.fatalError("configure");
        m_configuration = configuration;
    }


}      
      </pre>      
      
<p>
<strong>Example TestCase (from Phoenix's own PUnit TestCase)</strong>
</p>      
      
<pre class="code">
public class PUnitTestCaseTestCase extends PUnitTestCase
{

    DefaultConfigurationBuilder m_defaultConfigurationBuilder = new DefaultConfigurationBuilder();


    public PUnitTestCaseTestCase(String name)
    {
        super(name);
    }

    public void testBasicBlock() throws Exception
    {
        TestBlock block = new TestBlock();
        Configuration configuration = m_defaultConfigurationBuilder.build(
                new InputSource(new StringReader("&lt;hi&gt;Hi&lt;/hi&gt;")));
        addBlock("bl","block", block, configuration);
        startup();
        // check lifecycle run thru
        assertNotNull("Configuration null", block.m_configuration);
        assertNotNull("Context null", block.m_context);
        assertNotNull("Logger null", block.m_logger);
        assertNotNull("ServiceManager null", block.m_serviceManager);
        assertTrue("Not Initialized", block.m_initialized);
        // check lifecycle events logged
        assertTrue("Service Not logged", super.logHasEntry("I:service"));
        assertTrue("Initialize Not logged", super.logHasEntry("W:initialize"));
        assertTrue("Contextualize Not logged", super.logHasEntry("E:contextualize"));
        assertTrue("Configure Not logged", super.logHasEntry("F:configure"));
        shutdown();
    }

}      
      </pre>
      
<p>
        What is shown here is a single block being manually instantiated, and registered with PUnit 
        (addBlock).  Configuration rather than being from a file, is handed in from this source 
        via DefaultConfigurationBuilder (see its other methods for more flexibility).  The method 
        startup() is causing the components (one only in this case) to be started. After the normal 
        asserts have been invoked, the shutdown() is appropriate to tidy up in time for the next 
        test.  If you have multiple tests to do, it might be best to do all that is setup and 
        tearDown methods.       
      </p>
      
<p>
        It is important for developers to know the order of dependancy of their components, and in
        fact, the dependency needs of all components used in the test.  This is normally the role
        of the assembler rather than the developer, but there is no way that unit testing can 
        occur without all component needs being satisfied.  Of course the developer can use mock
        implementations of the required services.  Lastly, the order of dependency is important.
        Phoenix itself spends some effort determining which components are not needed by anything
        and cycles them first during startup.  The last to be cycled are those that depend on the
        others.
      </p>
    
    
<div class="h3">
<h3>To Use</h3>
</div>
      
<p>
        When setting up a classpath, excalibur's containerkit and il8n jars are dependencies for Punit...
      </p>
      
<pre class="code">
  &lt;path id="test.class.path"&gt;
    &lt;pathelement location="build/testclasses"/&gt;
    &lt;path refid="compile.classpath"/&gt;
    &lt;pathelement location="lib/phoenix-punit.jar"/&gt;        
    &lt;pathelement location="lib/excalibur-containerkit-1.0.jar"/&gt;    
    &lt;pathelement location="lib/excalibur-i18n-1.0.jar"/&gt;
  &lt;/path&gt;     
      </pre>
      
<p>
        As with most testing frameworks, compilation of test classes is required before tests can be invoked...
      </p>
      
<pre class="code">      
     &lt;target name="test" depends="compile" description="compiles and runs unit tests"&gt;
 
         &lt;mkdir dir="build/testclasses"/&gt;
 
         &lt;javac 
             destdir="build/testclasses"
             debug="${build.debug}"
             optimize="${build.optimize}"
             deprecation="${build.deprecation}"&gt;
             &lt;classpath refid="test.class.path" /&gt;
             &lt;src path="src/test" /&gt;
         &lt;/javac&gt;
 
         &lt;mkdir dir="build/tests"/&gt;
 
         &lt;junit fork="true"
             haltonfailure="${junit.failonerror}"
             printsummary="yes"
             dir="build/tests"&gt;
             &lt;classpath refid="test.class.path"/&gt;
 
             &lt;formatter type="plain"/&gt;
 
             &lt;batchtest todir="build/tests"&gt;
                 &lt;fileset dir="build/testclasses"&gt;
                     &lt;include name="**/*TestCase.class"/&gt;
                     &lt;exclude name="**/Abstract*"/&gt;
                 &lt;/fileset&gt;
             &lt;/batchtest&gt;
         &lt;/junit&gt;
 
    &lt;/target&gt; 
      </pre>    
    

  

<div id="authors" align="right">by&nbsp;Paul Hammant</div>
</div>
</div>
</div>
</td>
<!--================= end Content ==================-->
</tr>
</tbody>
</table>
<!--================= end Main ==================-->
<!--================= start Footer ==================-->
<div id="footer">
<table summary="footer" cellspacing="0" cellpadding="4" width="100%" border="0">
<tbody>
<tr>
<!--================= start Copyright ==================-->
<td colspan="2">
<div align="center">
<div class="copyright">
              Copyright &copy; 2002-2003&nbsp;The Apache Software Foundation.. All rights reserved.
            </div>
</div>
</td>
<!--================= end Copyright ==================-->
</tr>
<tr>
<td align="left">
<!--================= start Host ==================-->
<!--================= end Host ==================--></td><td align="right">
<!--================= start Credits ==================-->
<div align="right">
<div class="credit"></div>
</div>
<!--================= end Credits ==================-->
</td>
</tr>
</tbody>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
