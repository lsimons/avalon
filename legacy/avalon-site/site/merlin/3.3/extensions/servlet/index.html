
  

  
  

  
  

  

  
  

  
  

  
  

  

  

  

  

  

  
  
  
  
      
  

      
      
      
      
      
      
        
         
      
      

      
      
      
      

      
      
      

      

  
  

  
  

   
   


    
	
	

    
    
      
	
	
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

    <html>
      <head>
        
        
          <title>
            Merlin - 
          Merlin Servlet
        
          </title>
        
        
        
        <style type="text/css">
          @import url("../../style/tigris.css");
          @import url("../../style/maven.css");
        </style>
        
        
        
        
        
        <link rel="stylesheet" href="../../style/print.css" type="text/css" media="print"></link>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta>
        
          <meta name="author" content="Avalon Development Team"></meta>
          <meta name="email" content="avalon-dev@jakarta.apache.org"></meta>
        
        
        
        
      </head>

      <body class="composite">

        <div id="banner">
          <table height="103" border="0" width="100%" cellpadding="8" cellspacing="0">
            <tr>
              
              <td>
                
                
                  
                  
                  
                    
                  
                  
                  
                  
                  
                  <a href="http://avalon.apache.org/">
                    <img border="0" alt="The Apache Software Foundation" src="http://avalon.apache.org/images/apache-avalon-logo.png" align="left"></img>
                  </a>
                
              </td>

              <td></td>
              

            </tr>
          </table>
        </div>
        <div id="breadcrumbs">
          <table border="0" width="100%" cellpadding="4" cellspacing="0">
            <tr>
              
              <td>
                <div align="right">
                  
                  
                  
                    
    
    
      
      
      
      <a href="http://apache.org/">Apache</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/">Avalon</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/framework/">Framework</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/containers/">Containment</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/components/">Components</a>
      
    
  
                  
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <table border="0" width="100%" cellpadding="8" cellspacing="0"> 
          <tr valign="top">
            <td width="20%" id="leftcol">
              <div id="navcolumn">
                

                
                  
    <div>
      <strong>About Merlin</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../about/index.html">Overview</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/index.html">Getting Started</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../merlin/index.html">Merlin System</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../meta/index.html">Meta Model</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../tools/index.html">Tools</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../extensions/index.html">Extensions</a>
      	
      </small>
	  
        
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../extensions/http/index.html">HTTP Server Facility</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      		<b><a href="../../extensions/servlet/index.html">Merlin Servlet</a></b>
      	
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../extensions/jmx/index.html">JMX Facility</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../extensions/3rdparty/index.html">3rd Party</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    </div>
  
    <div>
      <strong>Resources</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../api/index.html">Javadoc</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../reference/index.html">Specification</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../resources/download.html">Download</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../resources/roadmap/index.html">Roadmap</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../dpml/index.html">DPML</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
    <div>
      <strong>Related Projects</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/meta">Meta</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/util">Utilities</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/repository">Repository</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
                
                
                
                

                
                
                <div>
                  <strong>Project Documentation</strong>
                  
                  <div>
                    <small>
                      <a href="../../project-info.html">Project Info</a>
                    </small>
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                  </div>
                  <div>
                    <small>
                      <a href="../../maven-reports.html">Project Reports</a>
                    </small>
                    
					
                    
                    
                    
                    
                    
                  </div>
                  
                  
                </div>
              
              
                
                
                
                
              
                
              </div>
            </td>
            <td rowspan="2">
              <div id="bodycol">
                
                <div class="app">
                  
                  
    <div class="h3">
      
      
        <h3>
          <a name="Merlin Servlet">Merlin Servlet</a>
        </h3>
      
      
    <p>
      
        The Merlin Servlet package contains an abstract Servlet implementation 
        that contains an embedded Merlin Kernel.
      
    </p>
   
    <div class="h4">
      
      
        <h4>
          <a name="Development Notes">Development Notes</a>
        </h4>
      
      
    <p>
      
          This is a minimal implementation of a Servlet that contains an 
          embedded kernel.  The behaviour is a function of the block.xml 
          resource resolved via the initialisation parameters.  No support 
          is included for configuration of the kernel and as such the kernel
          is established relative to defaults.  This will be enhanced in a 
          later revision.
        
    </p>
   
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Example web.xml">Example web.xml</a>
        </h4>
      
      
    <p>
      
          
    <i>
      web.xml
    </i>
   
        
    </p>
   
    <div id="source">
      <pre>
&lt;!DOCTYPE web-app 
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" 
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;

&lt;web-app&gt;

  &lt;display-name&gt;Merlin Servlet&lt;/display-name&gt;

  &lt;description&gt;
    Merlin Servlet Test Page.
  &lt;/description&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;merlin&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.avalon.merlin.servlet.TestServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;block&lt;/param-name&gt;
      &lt;param-value&gt;/BLOCK-INF/block.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
&lt;/web-app&gt;
</pre>
    </div>
  
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Servlet Implementation">Servlet Implementation</a>
        </h4>
      
      
    <p>
      
          
    <i>
      MerlinServlet.java
    </i>
   
        
    </p>
   
    <div id="source">
      <pre>
package org.apache.avalon.merlin.servlet;

import java.io.File;
import java.net.URL;
import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServlet;

import org.apache.avalon.assembly.locator.DefaultLocator;
import org.apache.avalon.merlin.kernel.Kernel;
import org.apache.avalon.merlin.kernel.impl.DefaultKernel;

/**
 * Servlet that handles the establishment of a Merlin Kernel
 * and registration of the kernel base URL under the servlet 
 * context using the key {@link Kernel.BASE_URL_KEY}.
 *
 * @author Avalon Development Team
 */
public class MerlinServlet extends HttpServlet
{
    private DefaultKernel m_kernel;

    /**
     * Initializes Servlet by the web server container.
     *
     * @exception ServletException if an error occurs
     */
    public void init()
        throws ServletException
    {
        try
        {
            ClassLoader loader = Thread.currentThread().getContextClassLoader();

            String homePath = getServletContext().getRealPath( "." );
            File home = new File( homePath );

            String blockPath = getInitParameter( "block", "BLOCK-INF/block.xml" );
            URL block = new File( home, blockPath ).toURL();

            DefaultLocator context = new DefaultLocator();
            context.put( "urn:merlin:home", home );
            context.put( "urn:merlin:system", home );
            context.put( "urn:merlin:classloader.common", loader );
            context.put( "urn:merlin:classloader.system", loader );
            context.put( "urn:merlin:debug", "WARN" );
            context.put( "urn:merlin:logging.priority", "INFO" );
            context.put( "urn:merlin:block.url", block );
            context.makeReadOnly();

            m_kernel = new DefaultKernel();
            m_kernel.contextualize( context );
            m_kernel.initialize();

            getServletContext().setAttribute( Kernel.BASE_URL_KEY, m_kernel.getURL() );

            log( "kernel established" );
        }
        catch( Exception e )
        {
            throw new ServletException( "Initialization error.", e );
        }
    }

    /**
     * Disposes of container manager and container instance.
     */
    public void destroy()
    {
        if( m_kernel != null )
        { 
            m_kernel.shutdown();
            m_kernel = null;
        }
    }

    private String getInitParameter( final String name, final String defaultValue )
    {
        final String value = getInitParameter( name );
        if ( null == value )
        {
            return defaultValue;
        }
        else
        {
            return value;
        }
    }
}
</pre>
    </div>
  
    </div>
  
    </div>
  
                  
                  
                  
                  
                  
                </div>
              </div>
            </td>
          </tr>
        </table>
        <div id="footer">
          <table border="0" style="width:100%" cellpadding="4" cellspacing="0">
            
            <tr>
              <td>
                
                  
                    
                    
                      © 1997-2004, The Apache Software Foundation
                    
                  
                  
                

                
              </td>
              
            </tr>
          </table>
        </div>
      </body>
    </html>
  