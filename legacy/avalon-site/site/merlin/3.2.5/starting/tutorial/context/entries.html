
  

  
  

  
  

  

  
  

  
  

  
  

  

  

  

  

  

  
  
  
  
      
  

      
      
      
      
      
      
        
         
      
      

      
      
      
      

      
      
      

      

  
  

  
  

   
   


    
	
	

    
    
      
	
	
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

    <html>
      <head>
        
        
          <title>
            Merlin - 
          
        
          </title>
        
        
        
        <style type="text/css">
          @import url("../../../style/tigris.css");
          @import url("../../../style/maven.css");
        </style>
        
        
        
        
        
        <link rel="stylesheet" href="../../../style/print.css" type="text/css" media="print"></link>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta>
        
        
        
        
      </head>

      <body class="composite">

        <div id="banner">
          <table height="103" border="0" width="100%" cellpadding="8" cellspacing="0">
            <tr>
              
              <td>
                
                
                  
                  
                  
                    
                  
                  
                  
                  
                  
                  <a href="http://avalon.apache.org/">
                    <img border="0" alt="Apache Software Foundation" src="http://avalon.apache.org/images/apache-avalon-logo.png" align="left"></img>
                  </a>
                
              </td>

              <td></td>
              

            </tr>
          </table>
        </div>
        <div id="breadcrumbs">
          <table border="0" width="100%" cellpadding="4" cellspacing="0">
            <tr>
              
              <td>
                <div align="right">
                  
                  
                  
                    
    
    
      
      
      
      <a href="http://apache.org/">Apache</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/">Avalon</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/framework/">Framework</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/containers/">Containers</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/components/">Components</a>
      
    
  
                  
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <table border="0" width="100%" cellpadding="8" cellspacing="0"> 
          <tr valign="top">
            <td width="20%" id="leftcol">
              <div id="navcolumn">
                

                
                  
    <div>
      <strong>About Merlin</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../about/index.html">Overview</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/index.html">Getting Started</a>
      	
      </small>
	  
        
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/installation/index.html">Installation</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/index.html">Using Merlin</a>
      	
      </small>
	  
        
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/creation.html">Hello Block</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/execution.html">Running Hello</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/internal.html">Behind the Scenes</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/config/index.html">Configurations</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/context/index.html">Contextualization</a>
      	
      </small>
	  
        
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/context/standard.html">Standard Entries</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      		<b><a href="../../../starting/tutorial/context/entries.html">Custom Entries</a></b>
      	
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/context/casting.html">Context Casting</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/services.html">Services</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/tutorial/dependencies/index.html">Dependencies</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../starting/advanced/index.html">Advanced Features</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../merlin/index.html">Merlin System</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../meta/index.html">Meta Model</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../tools/index.html">Tools</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
    <div>
      <strong>Resources</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../api/index.html">Javadoc</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../resources/download.html">Download</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../resources/roadmap/index.html">Roadmap</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../../dpml/index.html">DPML</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
    <div>
      <strong>Related Projects</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/meta">Meta</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/util">Utilities</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/repository">Repository</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
                
                
                
                

                
                
                <div>
                  <strong>Project Documentation</strong>
                  
                  <div>
                    <small>
                      <a href="../../../project-info.html">Project Info</a>
                    </small>
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                  </div>
                  <div>
                    <small>
                      <a href="../../../maven-reports.html">Project Reports</a>
                    </small>
                    
					
                    
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                    
                    
                    
                  </div>
                  
                  
                </div>
              
              
                
                
                
                
              
                
              </div>
            </td>
            <td rowspan="2">
              <div id="bodycol">
                
                <div class="app">
                  
                  
    <div class="h3">
      
      
        <h3>
          <a name="Using Merlin">Using Merlin</a>
        </h3>
      
      
    <div class="h4">
      
      
        <h4>
          <a name="Custom Context Management">Custom Context Management</a>
        </h4>
      
      
    <p>
      
        Merlin provides support for the creation and assignment of 
        custom context entries to a component through a combination 
        of requirements specification at the level of a type, and 
        context creation directives.
        
    </p>
   
    <p>
      
        Resources supporting this tutorial are contained in the 
        tutorials/context/custom/ package.
        
    </p>
   
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Creating a non-Component Object">Creating a non-Component Object</a>
        </h4>
      
      
    <p>
      
          To demonstrate Merlin's support for the supply of non-component 
          objects to a component, we need to create an 
          example object.  Non-component object approaches may be
          required when you are integrating legacy applications 
          into a component platform and you are obliged to deal 
          with an existing code base.
        
    </p>
   
    <p>
      
          Our non-component example NumberCruncher takes two values
          in a constructor and returns the result of the multiplication
          of the two numbers via an accessor.  While not very useful, the  
          purpose of NumberCruncher is to demonstrate how you can use 
          Merlin to construct the instance and associate it as a context 
          entry for the component.
        
    </p>
   
    <p>
      
          
    <i>
      NumberCruncher.java
    </i>
   
        
    </p>
   
    <div id="source">
      <pre>
package tutorial;

/**
 * A demonstration class that that we will instantiate via 
 * context directives within the component declaration.
 */
public class NumberCruncher
{
    private final int m_primary;
    private final float m_secondary;

    public NumberCruncher( Integer primary, Double secondary )
    {
        m_primary = primary.intValue();
        m_secondary = secondary.floatValue();
    }
 
   /**
    * Multiply the supplied constructor arguments together and 
    * return the value.
    */
    public float crunch()
    {
       return ( m_secondary * m_primary );
    }
}
</pre>
    </div>
  
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Updating HelloComponent.xinfo">Updating HelloComponent.xinfo</a>
        </h4>
      
      
    <p>
      
        HelloComponent.xinfo is updated to include the declaration of 
        the components requirement for the supply of a context entry  
        named 'cruncher' corresponding to the type NumberCruncher.
        
    </p>
   
    <p>
      
    <i>
      HelloComponent.xinfo
    </i>
   
    </p>
   
    <div id="source">
      <pre>
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE type PUBLIC "-//AVALON/Type DTD Version 1.0//EN" 
  "http://avalon.apache.org/dtds/meta/type_1_1.dtd" &gt;

&lt;type&gt;
  &lt;info&gt;
    &lt;name&gt;demo&lt;/name&gt;
    &lt;version&gt;-1.0.0&lt;/version&gt;
    &lt;lifestyle&gt;transient&lt;/lifestyle&gt;
  &lt;/info&gt;
  &lt;context&gt;
    &lt;entry key="cruncher" type="tutorial.NumberCruncher" /&gt;
  &lt;/context&gt;
&lt;/type&gt;
</pre>
    </div>
  
    <p>
      
        The following source demonstrates the implementation
        of the contextualization stage, access and casting of
        a context entry to the NumberCruncher class, and the 
        the invocation of on operation on that class.
        
    </p>
   
    <div id="source">
      <pre>
package tutorial;

import org.apache.avalon.framework.logger.AbstractLogEnabled;
import org.apache.avalon.framework.context.Contextualizable;
import org.apache.avalon.framework.context.Context;
import org.apache.avalon.framework.context.ContextException;

/**
 * Demonstration of a component that uses a constructed context entry.
 * 
 * @avalon.component name="demo"
 */
public class HelloComponent extends AbstractLogEnabled 
  implements Contextualizable
{

   /**
    * Contextualization of the component by the container.
    * The context supplied by the container shall contain
    * a NumberCruncher instance as declared in the xinfo resource.
    *
    * @avalon.context
    * @avalon.entry key="cruncher" type="tutorial.NumberCruncher"
    */
    public void contextualize( Context context )
      throws ContextException
    {
        NumberCruncher cruncher = 
          (NumberCruncher) context.get( "cruncher" );
        float value = cruncher.crunch();
        getLogger().info( "result: " + value );
    }
}
</pre>
    </div>
  
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Context Directives">Context Directives</a>
        </h4>
      
      
    <p>
      
        As Merlin knows nothing about the NumberCruncher class
        we need to provide additional information under the component
        deployment descriptor.  In the case of NumberCruncher, the 
        class constructor takes two constructor arguments, an Integer
        and a Double.
        
    </p>
   
    <p>
      
    <i>
      block.xml
    </i>
   
    </p>
   
    <div id="source">
      <pre>
&lt;container name="tutorial"&gt;

   &lt;classloader&gt;
     &lt;classpath&gt;
       &lt;repository&gt;
         &lt;resource 
           id="avalon-framework:avalon-framework-impl" 
           version="4.1.5"/&gt;
       &lt;/repository&gt;
     &lt;/classpath&gt;
   &lt;/classloader&gt;


   &lt;component name="hello" class="tutorial.HelloComponent"&gt;
     &lt;context&gt;
       &lt;entry key="cruncher"&gt;
         &lt;constructor class="tutorial.NumberCruncher"&gt;
           &lt;param class="java.lang.Integer"&gt;7&lt;/param&gt;
           &lt;param class="java.lang.Double"&gt;1.5&lt;/param&gt;
         &lt;/constructor&gt;
       &lt;/entry&gt;
     &lt;/context&gt;
   &lt;/component&gt;

&lt;/container&gt;
</pre>
    </div>
  
    <p>
      
        Build and run the tutorial.
        
    </p>
   
    <div id="source">
      <pre>
$ maven
$ merlin -execute target\classes
        </pre>
    </div>
  
    <p>
      
        In the logging output we see that Merlin has created and 
        supplied the NumberCruncher instance to the component.
        
    </p>
   
    <div id="source">
      <pre>
[INFO   ] (tutorial.hello): result: 10.5
        </pre>
    </div>
  
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Context Casting">Context Casting</a>
        </h4>
      
      
    <p>
      
        The 
    <a href="casting.html">next tutorial</a>
   shows how 
        Merlin provides support for type-safe context casting.
        
    </p>
   
    </div>
  
    </div>
  
                  
                  
                  
                  
                  
                </div>
              </div>
            </td>
          </tr>
        </table>
        <div id="footer">
          <table border="0" style="width:100%" cellpadding="4" cellspacing="0">
            
            <tr>
              <td>
                
                  
                    
                    
                      © 1997-2004, Apache Software Foundation
                    
                  
                  
                

                
              </td>
              
            </tr>
          </table>
        </div>
      </body>
    </html>
  