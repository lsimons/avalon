
  

  
  

  
  

  

  
  

  
  

  
  

  

  

  

  

  

  
  
  
  
      
  

      
      
      
      
      
      
        
         
      
      

      
      
      
      

      
      
      

      

  
  

  
  

   
   


    
	
	

    
    
      
	
	
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

    <html>
      <head>
        
        
          <title>
            Avalon Sandbox - 
          MRUMemoryStore and Swapping
        
          </title>
        
        
        
        <style type="text/css">
          @import url("./style/tigris.css");
          @import url("./style/maven.css");
        </style>
        
        
        
        
        
        <link rel="stylesheet" href="./style/print.css" type="text/css" media="print"></link>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta>
        
          <meta name="author" content="Avalon Documentation Team"></meta>
          <meta name="email" content="dev@avalon.apache.org"></meta>
        
        
        
        
      </head>

      <body class="composite">

        <div id="banner">
          <table border="0" width="100%" cellpadding="8" cellspacing="0">
            <tr>
              
              <td>
                
                
                  
                  
                  
                    
                  
                  
                  
                  
                  
                  <a href="http://avalon.apache.org/">
                    <img border="0" alt="Apache Software Foundation" src="http://avalon.apache.org/images/apache-avalon-logo.png" align="left"></img>
                  </a>
                
              </td>

              
              <td>
                <div id="login" align="right">
                  
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        <div id="breadcrumbs">
          <table border="0" width="100%" cellpadding="4" cellspacing="0">
            <tr>
              
              <td>
                <div align="right">
                  
                  
                  
                    
    
    
      
      
      
      <a href="http://apache.org/">Apache</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/">Avalon</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/framework/">Framework</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/containers/">Containers</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/components/">Components</a>
      
    
  
                  
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <table border="0" width="100%" cellpadding="8" cellspacing="0"> 
          <tr valign="top">
            <td width="20%" id="leftcol">
              <div id="navcolumn">
                

                
                  
    <div>
      <strong>About Excalibur</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="index.html">Overview</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="configuration/index.html">Configuration</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="i18n/index.html">I18N</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="sourceresolve-index.html">Sourceresolver</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="store-index.html">Store</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="component.html">ECM</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
    <div>
      <strong>Project</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/download.cgi">Download</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="no-docs-available.html">Where's my documentation???</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/excalibur/api/">Javadocs</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
                
                
                
                

                
                
                <div>
                  <strong>Project Documentation</strong>
                  <div>
                    <small>
                      <a href="./index.html">About Avalon Excalibur</a>
                    </small>
                  </div>
                  <div>
                    <small>
                      <a href="./project-info.html">Project Info</a>
                    </small>
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                  </div>
                  <div>
                    <small>
                      <a href="./maven-reports.html">Project Reports</a>
                    </small>
                    
					
                    
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                      
                      
                    
                    
                    
                    
                  </div>
                  
                    
                  
                  
                  
                  
                  
                    <div>
                      <small>
                        
                        <a href="http://maven.apache.org/development-process.html">Development Process</a>
                      </small>
                    </div>
                  
                </div>
              
              
                
                
                
                
              
                
              </div>
            </td>
            <td rowspan="2">
              <div id="bodycol">
                
                <div class="app">
                  
                  
    <div class="h3">
      
      
        <h3>
          <a name="Goal">Goal</a>
        </h3>
      
      
    <p>
      This document explains how the MRUMemoryStore and Swapping executes.
    </p>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Overview">Overview</a>
        </h3>
      
      
    <p>
      The MRUMemoryStore was developed to provide a standard algorithm to
       store data in memory. For web-based applications the MRU (Most Recently Used) algorithm
       is very suitable, because the object most frequently accessed is always on "top".
    
    </p>
   
    <p>
      If configured, the objects are also swapped to the filesystem if the
    MRUMemoryStore reached his configured max. object limit.
    
    </p>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Implementation">Implementation</a>
        </h3>
      
      
    <div class="h4">
      
      
        <h4>
          <a name="MRUMemoryStore">MRUMemoryStore</a>
        </h4>
      
      
    <p>
       
    The heart of the MRUMemoryStore ist combination of a LinkedList and a HashMap:
    
    </p>
   
    <p>
      
    The LinkedList provides the queue mechanism, and the entries in the LinkedList 
    contain the key to the data in the HashMap. When caching a new entry in to the list,
    the entry is inserted to the front of the list.
    If the list is already full, the oldest data entry is removed from the Cache.
    When requesting a entry, the store returns the object by key and inserts the requested key 
    on the top of the Cache.
       
    This implementation keeps the most recent used objects in the store and provides the best
    use of the machines memory.
    
    </p>
   
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Swapping">Swapping</a>
        </h4>
      
      
    <p>
      
    When the MRUMemoryStore is full or the JVM is at the heap size limit the 
    objects in the MRUMemoryStore are swapped to the Filesystem. The default 
    directory is "cache-dir" in the work-directory.
    
    </p>
   
    <p>
      
    NOTE: The keys are Strings at the moment. Therefor the
    filenames of the swapped objects can be very long. Especially Windows OS
    flavours have problems with long filenames. Use the JispFilesystemStore to
    get rid of it.
    
    </p>
   
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Configuration of the MRUMemoryStore in the cocoon.xconf">Configuration of the MRUMemoryStore in the cocoon.xconf</a>
        </h3>
      
      
    <div id="source">
      <pre>
&lt;store class="org.apache.excalibur.store.impl.MRUMemoryStore"
       logger="core.store"&gt;
  &lt;parameter name="maxobjects" value="100"/&gt;
  &lt;parameter name="use-persistent-cache" value="true"/&gt;
&lt;/store&gt;
  </pre>
    </div>
  
    <p>
      Explanation of the paramters:
    </p>
   
    <ol>
       
      
    <li>
      
    <code>
      &lt;parameter name="maxobjects" value="100"/&gt;
    </code>
   :
      Indicates how many objects will be hold in MRUMemoryStore. When the number 
      of maxobjects has been reached, the last object in the MRUMemoryStore will be 
      thrown out.
    </li>
   
      
    <li>
      
    <code>
      &lt;parameter name="use-persistent-cache" value="true"/&gt;
    </code>
   :
      If this switch is set on true, objects are swapped out to the filesystem,
      if the MRUMemoryStore has reached his maximum object limit, or the JVM 
      memory consumption is over the heap size limit. See StoreJanitor user 
      docs for more information.
    </li>
   
    
    </ol>
   
    </div>
  
                  
                  
                  
                  
                  
                </div>
              </div>
            </td>
          </tr>
        </table>
        <div id="footer">
          <table border="0" style="width:100%" cellpadding="4" cellspacing="0">
            
            <tr>
              <td>
                
                  
                    
                    
                      © 1997-2003, Apache Software Foundation
                    
                  
                  
                

                
              </td>
              
            </tr>
          </table>
        </div>
      </body>
    </html>
  