<?xml version="1.0"?>

<project default="check"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant"
    xmlns:deploy="deploy">

    <!-- include the avalon-wide custom project properties -->
    <property file="${basedir}/project.properties"/>

    <goal name="check">
        <!-- friendly error in case file is not available -->
        <ant:available file="${avalon.buildsystem}/maven-common.xml"
                property="buildsystem.available"/>
        <ant:available classname="javax.mail.Message" property="javamail.present"/>
        <ant:available classname="javax.jms.Message" property="jms.present"/>
        <ant:fail unless="buildsystem.available">
          ===================================================================
          BUILD SYSTEM FAILURE!
          ===================================================================

          a required file, ${avalon.buildsystem}/maven-common.xml, cannot be
          found. Try setting the avalon.buildsystem property in
          project.properties to the correct location.
        </ant:fail>
        <ant:fail unless="javamail.present">
          Avalon LogKit must have JavaMail in your repository.  You must
          download it manually from the URL provided here:

          http://java.sun.com/products/javamail/index.html

          Place the jar in your repository in the subdirectory:

          javamail/jars
        </ant:fail>
        <ant:fail unless="jms.present">
          Avalon LogKit must have JavaMail in your repository.  You must
          download it manually from the URL provided here:

          http://java.sun.com/products/jms/docs.html

          Place the jar in your repository in the subdirectory:

          jms/jars
        </ant:fail>
    </goal>

    <!-- include the avalon-wide custom goal decorators from maven-common.xml -->
    <j:import file="${avalon.buildsystem}/maven-common.xml" inherit="true"/>

    <preGoal name="java:compile">
        <ant:property name="java.src.dir" location="${maven.build.dir}/src"/>
        <ant:copy todir="${java.src.dir}">
            <ant:fileset dir="${basedir}/src/java"/>
            <ant:fileset dir="${basedir}/src/compat"/>
        </ant:copy>
    </preGoal>

    <postGoal name="avalon:deploy-upload">
        <!-- upload big jar -->
        <ant:exec dir="." executable="${maven.scp.executable}">
            <ant:arg line="${scpopts} target/${pom.artifactId}-complete-${pom.currentVersion}.jar ${repo}/${pom.groupId}/jars/"/>
        </ant:exec>
    </postGoal>

</project>
