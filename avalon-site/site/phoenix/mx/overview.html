<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--*** This is a generated file.  Do not edit.  ***-->
<link rel="stylesheet" href="../skin/tigris.css" type="text/css">
<link rel="stylesheet" href="../skin/mysite.css" type="text/css">
<link rel="stylesheet" href="../skin/site.css" type="text/css">
<link media="print" rel="stylesheet" href="../skin/print.css" type="text/css">
<title>Guide - Step by Step Overview</title>
</head>
<body bgcolor="white" class="composite">
<!--================= start Banner ==================-->
<div id="banner">
<table width="100%" cellpadding="8" cellspacing="0" summary="banner" border="0">
<tbody>
<tr>
<!--================= start Group Logo ==================-->
<td align="left">
<div class="groupLogo">
<a href="http://avalon.apache.org/"><img border="0" class="logoImage" alt="Apache Avalon-Phoenix" src="../images/apache-avalon-logo.png"></a>
</div>
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td align="right">
<div class="projectLogo">
<a href="http://apachecon.com/2003/US/index.html"><img border="0" class="logoImage" alt="Visit ApacheCon 2003!" src="http://www.apache.org/~ceki/ac2003/ac2003-150.gif"></a>
</div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</tbody>
</table>
</div>
<!--================= end Banner ==================-->
<!--================= start Main ==================-->
<table width="100%" cellpadding="0" cellspacing="0" border="0" summary="nav" id="breadcrumbs">
<tbody>
<!--================= start Status ==================-->
<tr class="status">
<td>
<!--================= start BreadCrumb ==================--><a href="http://www.apache.org/">Apache Main</a> | <a href="http://avalon.apache.org/">Avalon Main</a> | <a href="../">Up</a>
<!--================= end BreadCrumb ==================--></td><td id="tabs">
<!--================= start Tabs ==================-->
<div class="tab">
<span class="unselectedTab"><a href="http://www.apache.org/">Apache</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/">Avalon</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/framework/">Framework</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/containers/">Containers</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/components/">Components</a></span>
</div>
<!--================= end Tabs ==================-->
</td>
</tr>
</tbody>
</table>
<!--================= end Status ==================-->
<table id="main" width="100%" cellpadding="8" cellspacing="0" summary="" border="0">
<tbody>
<tr valign="top">
<!--================= start Menu ==================-->
<td id="leftcol">
<div id="navcolumn">
<div class="menuBar">
<div class="menu">
<span class="menuLabel">Essentials</span>

<div class="menuItem">
<a href="../index.html">Overview</a>
</div>

<div class="menuItem">
<a href="../features.html">Features</a>
</div>

<div class="menuItem">
<a href="../getting-started.html">Getting started</a>
</div>

<div class="menuItem">
<a href="http://avalon.apache.org/bindownload.cgi">Download</a>
</div>

<div class="menuItem">
<a href="../install.html">Install</a>
</div>

</div>
<div class="menu">
<span class="menuLabel">Guide</span>

<div class="menuItem">
<a href="../guide-architecture.html">Architectural Overview</a>
</div>

<div class="menuItem">
<a href="../guide-roles.html">Development Roles</a>
</div>

<div class="menuItem">
<a href="../guide-administrator.html">for Administrators</a>
</div>

<div class="menuItem">
<a href="../guide-deployers.html">for Deployers</a>
</div>

<div class="menuItem">
<a href="../assemblers/index.html">for Assemblers</a>
</div>

<div class="menuItem">
<a href="../bdg/index.html">for Block Developers</a>
</div>

<div class="menuItem">
<a href="../mx/index.html">Management Guide</a>
</div>

<div class="menuItem">
<a href="../guide-example-configuration.html">Example configuration</a>
</div>

<div class="menuItem">
<a href="../guide-punit.html">PUnit unit testing</a>
</div>

</div>
<div class="menu">
<span class="menuLabel">Reference</span>

<div class="menuItem">
<a href="../api/index.html">API Docs</a>
</div>

<div class="menuItem">
<a href="../assemblers/config-xml-specification.html">config.xml Specification</a>
</div>

<div class="menuItem">
<a href="../assemblers/assembly-xml-specification.html">assembly.xml Specification</a>
</div>

<div class="menuItem">
<a href="../assemblers/environment-xml-specification.html">environment.xml Specification</a>
</div>

<div class="menuItem">
<a href="../bdg/blockinfo-specification.html">BlockInfo Specification</a>
</div>

</div>
<div class="menu">
<span class="menuLabel">For Developers</span>

<div class="menuItem">
<a href="../changes.html">Changes</a>
</div>

<div class="menuItem">
<a href="http://avalon.apache.org/code-standards.html">Coding standards</a>
</div>

<div class="menuItem">
<a href="../for-developers-project-structure.html">Project Structure</a>
</div>

<div class="menuItem">
<a href="http://jakarta.apache.org/site/cvsindex.html">CVS Repositories</a>
</div>

<div class="menuItem">
<a href="http://jakarta.apache.org/site/mail.html">Mailing Lists</a>
</div>

<div class="menuItem">
<a href="http://nagoya.apache.org/bugzilla/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&bug_status=RESOLVED&product=Avalon&component=Phoenix">TODO</a>
</div>

<div class="menuItem">
<a href="http://jira.werken.com/secure/BrowseProject.jspa?id=10081">Issue Tracker (Bug and Enhancement List)</a>
</div>

<div class="menuItem">
<a href="../for-developers-alternate-kernel.html">Alternate Kernels</a>
</div>

</div>
</div>
</div>
</td>
<!--================= end Menu ==================-->
<!--================= start Content ==================--><td>
<div id="bodycol">
<div class="app">
<div align="center">
<h1>Guide - Step by Step Overview</h1>
</div>
<div class="h3">
    
    
        
<div class="h3">
<h3>Introduction</h3>
</div>
            
<p>
              This section gives a quick overview of how to go from a block's source code, 
              to a managed object accessible in a management interface.  It discusses
              the role of actors at three different points in the
              life cycle of the application:
              during development, at start-up, and while running.  
            </p>

            
<div class="h4">
<h4>In Development</h4>
</div>
                
<p>
                  For a block to be manageable, the developer must provide an
                  MXINFO file along with the compiled code.  The easiest way 
                  to do that is to insert a series of XDoclet tags
                  into the source file.  An example of how to use these tags follows.
                </p>
                
<p>
                First, at the class level, the block must be tagged as manageable
                with @phoenix:mx-topic tag:
                </p>

                
<pre class="code">
/**
 * Ftp server starting point. Avalon framework will load this
 * from the jar file. This is also the starting point of remote
 * admin.
 *
 * @phoenix:block
 * @phoenix:mx-topic name="ftpServer"
 * @phoenix:service name="org.apache.avalon.ftpserver...
 */
public class FtpServerImpl extends AbstractLogEnabled
...
                </pre>
                
<p>
                  Then, for each attribute that should be exposed add the 
                  @phoenix:mx-attribute tag:
                </p>
                
<pre class="code">
    /**
     * @phoenix:mx-attribute
     * @phoenix:mx-description Returns the top published directory
     * @phoenix:mx-isWriteable false
     */
    public String getDefaultRoot() {
    ...
                </pre>
                
<p>
                and finally for each operation add the @phoenix:mx-operation tag:
                </p>
                
<pre class="code">
    /**
     * @phoenix:mx-operation
     * @phoenix:mx-description Returns port that the server listens on
     */
    public String getServerPort(Integer instance) {
    ...
                </pre>
                
<p>
                    When this is compiled the PhoenixDoclet task extracts this and inserts it
                    into an mxinfo file.  If a method doesn't have a @pheonix:mx-attribute tag it is not exposed for
                    management.
                </p>
                
<p>
                    Here's what the entry generated from the tags above looks like:
                </p>

                
<pre class="code">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE mxinfo PUBLIC "-//PHOENIX/Mx Info DTD Version 1.0//EN"
                  "http://jakarta.apache.org/avalon/dtds/phoenix/mxinfo_1_0.dtd"&gt;

&lt;mxinfo&gt;

    &lt;topic name="ftpServer" &gt;

      &lt;!-- attributes --&gt;
      &lt;attribute
        name="defaultRoot"
        description="Returns the top published directory"
        isWriteable="no"
        type="java.lang.String"
      /&gt;

      &lt;!-- operations --&gt;
      &lt;operation
        name="getServerPort"
        description="Returns port that the server listens on"
        type="java.lang.String"
      &gt;
        &lt;param
          name="instance"
          description="no description"
          type="java.lang.Integer"
        /&gt;
      &lt;/operation&gt;

    &lt;/topic&gt;

&lt;/mxinfo&gt;

                </pre>

                
<p>
                    Alternatively, you could write the mxinfo file directly (particularly in cases
                    where you can't/don't want to modify the source code).
                    The DTD is called 'mxinfo.dtd' and is available in the /src/schema
                    directory of the source.
                </p>
            
            
<div class="h4">
<h4>At Startup</h4>
</div>
                
<p>
                    At startup, Phoenix registers each block to a local SystemManager context.  This
                    context determines where the block fits into the management hierarchy.
                </p>
                
<p>
                    The following code snippet shows the code snippet that registers
                    the Embeddor component with the 'component' management context.  A
                    similar process is followed for registering the blocks in 
                    the application.
                </p>
                
<pre class="code">
// get the management context
final SystemManager componentManager =
    systemManager.getSubContext( null, "component" );

// register the component
componentManager.register( ManagementRegistration.EMBEDDOR.getName(),
                           this,
                           ManagementRegistration.EMBEDDOR.getInterfaces() );    
                </pre>
                
<p>
                    The system manager uses the mxinfo file in conjunction with introspection to
                    generate a ModelMBeanInfo object for each topic.  A RequiredModelMBean is then
                    created and exposed for management.
                </p>
            
            
<div class="h4">
<h4>While Running</h4>
</div>
                
<p>
                    In the default configuration, management is provided through MX4J.  The administrator can perform various
                    tasks such as deploying, starting and stopping applications and changing the configuration of various
                    blocks.
                </p>
                
<p>
                    By default, the server is accessed on port 8082 of the server. eg. http://localhost:8082.
                </p>
            
        
    

<div id="authors" align="right">by&nbsp;Huw Roberts</div>
</div>
</div>
</div>
</td>
<!--================= end Content ==================-->
</tr>
</tbody>
</table>
<!--================= end Main ==================-->
<!--================= start Footer ==================-->
<div id="footer">
<table summary="footer" cellspacing="0" cellpadding="4" width="100%" border="0">
<tbody>
<tr>
<!--================= start Copyright ==================-->
<td colspan="2">
<div align="center">
<div class="copyright">
              Copyright &copy; 2002-2003&nbsp;The Apache Software Foundation.. All rights reserved.
            </div>
</div>
</td>
<!--================= end Copyright ==================-->
</tr>
<tr>
<td align="left">
<!--================= start Host ==================-->
<!--================= end Host ==================--></td><td align="right">
<!--================= start Credits ==================-->
<div align="right">
<div class="credit"></div>
</div>
<!--================= end Credits ==================-->
</td>
</tr>
</tbody>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
