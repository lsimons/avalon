<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--*** This is a generated file.  Do not edit.  ***-->
<link rel="stylesheet" href="skin/tigris.css" type="text/css">
<link rel="stylesheet" href="skin/mysite.css" type="text/css">
<link rel="stylesheet" href="skin/site.css" type="text/css">
<link media="print" rel="stylesheet" href="skin/print.css" type="text/css">
<title>Guide - for Administrators</title>
</head>
<body bgcolor="white" class="composite">
<!--================= start Banner ==================-->
<div id="banner">
<table width="100%" cellpadding="8" cellspacing="0" summary="banner" border="0">
<tbody>
<tr>
<!--================= start Group Logo ==================-->
<td align="left">
<div class="groupLogo">
<a href="http://avalon.apache.org/"><img border="0" class="logoImage" alt="Apache Avalon-Phoenix" src="images/apache-avalon-logo.png"></a>
</div>
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td align="right">
<div class="projectLogo">
<a href="http://apachecon.com/2003/US/index.html"><img border="0" class="logoImage" alt="Visit ApacheCon 2003!" src="http://www.apache.org/~ceki/ac2003/ac2003-150.gif"></a>
</div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</tbody>
</table>
</div>
<!--================= end Banner ==================-->
<!--================= start Main ==================-->
<table width="100%" cellpadding="0" cellspacing="0" border="0" summary="nav" id="breadcrumbs">
<tbody>
<!--================= start Status ==================-->
<tr class="status">
<td>
<!--================= start BreadCrumb ==================--><a href="http://www.apache.org/">Apache Main</a> | <a href="http://avalon.apache.org/">Avalon Main</a> | <a href="../">Up</a>
<!--================= end BreadCrumb ==================--></td><td id="tabs">
<!--================= start Tabs ==================-->
<div class="tab">
<span class="unselectedTab"><a href="http://www.apache.org/">Apache</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/">Avalon</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/framework/">Framework</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/containers/">Containers</a></span> | <span class="unselectedTab"><a href="http://avalon.apache.org/product/components/">Components</a></span>
</div>
<!--================= end Tabs ==================-->
</td>
</tr>
</tbody>
</table>
<!--================= end Status ==================-->
<table id="main" width="100%" cellpadding="8" cellspacing="0" summary="" border="0">
<tbody>
<tr valign="top">
<!--================= start Menu ==================-->
<td id="leftcol">
<div id="navcolumn">
<div class="menuBar">
<div class="menu">
<span class="menuLabel">Essentials</span>
        
<div class="menuItem">
<a href="index.html">Overview</a>
</div>
        
<div class="menuItem">
<a href="features.html">Features</a>
</div>
        
<div class="menuItem">
<a href="getting-started.html">Getting started</a>
</div>
        
<div class="menuItem">
<a href="http://avalon.apache.org/bindownload.cgi">Download</a>
</div>
        
<div class="menuItem">
<a href="install.html">Install</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Guide</span>
        
<div class="menuItem">
<a href="guide-architecture.html">Architectural Overview</a>
</div>
        
<div class="menuItem">
<a href="guide-roles.html">Development Roles</a>
</div>
        
<div class="menuItem">
<span class="menuSelected">for Administrators</span>
</div>
        
<div class="menuItem">
<a href="guide-deployers.html">for Deployers</a>
</div>
        
<div class="menuItem">
<a href="assemblers/index.html">for Assemblers</a>
</div>
        
<div class="menuItem">
<a href="bdg/index.html">for Block Developers</a>
</div>
        
<div class="menuItem">
<a href="mx/index.html">Management Guide</a>
</div>
        
<div class="menuItem">
<a href="guide-example-configuration.html">Example configuration</a>
</div>
        
<div class="menuItem">
<a href="guide-punit.html">PUnit unit testing</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Reference</span>
        
<div class="menuItem">
<a href="api/index.html">API Docs</a>
</div>
        
<div class="menuItem">
<a href="assemblers/config-xml-specification.html">config.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="assemblers/assembly-xml-specification.html">assembly.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="assemblers/environment-xml-specification.html">environment.xml Specification</a>
</div>
        
<div class="menuItem">
<a href="bdg/blockinfo-specification.html">BlockInfo Specification</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">For Developers</span>
        
<div class="menuItem">
<a href="changes.html">Changes</a>
</div>
        
<div class="menuItem">
<a href="http://avalon.apache.org/code-standards.html">Coding standards</a>
</div>
        
<div class="menuItem">
<a href="for-developers-project-structure.html">Project Structure</a>
</div>
        
<div class="menuItem">
<a href="http://jakarta.apache.org/site/cvsindex.html">CVS Repositories</a>
</div>
        
<div class="menuItem">
<a href="http://jakarta.apache.org/site/mail.html">Mailing Lists</a>
</div>
        
<div class="menuItem">
<a href="http://nagoya.apache.org/bugzilla/buglist.cgi?bug_status=UNCONFIRMED&bug_status=NEW&bug_status=ASSIGNED&bug_status=REOPENED&bug_status=RESOLVED&product=Avalon&component=Phoenix">TODO</a>
</div>
        
<div class="menuItem">
<a href="http://jira.werken.com/secure/BrowseProject.jspa?id=10081">Issue Tracker (Bug and Enhancement List)</a>
</div>
        
<div class="menuItem">
<a href="for-developers-alternate-kernel.html">Alternate Kernels</a>
</div>
    
</div>
<div class="menu">
<span class="menuLabel">Links</span>
        
<div class="menuItem">
<a href="applications.html">Applications</a>
</div>
    
</div>
</div>
</div>
</td>
<!--================= end Menu ==================-->
<!--================= start Content ==================--><td>
<div id="bodycol">
<div class="app">
<div align="center">
<h1>Guide - for Administrators</h1>
</div>
<div class="h3">
    
    
        
<div class="h3">
<h3>Introduction</h3>
</div>
            
<p>
              Avalon is a Server Framework that provides or will provide for
              central administration, server pooling, and quicker time to market.
              The framework defines a standard method of piecing together server
              components and creating a server.
            </p>
            
<div class="h4">
<h4>Target Audience</h4>
</div>
                
<p>
                  This documentation will describe the care and feeding of the Avalon
                  Phoenix kernel from the point of view of the administrator.
                </p>
            
        
        
<div class="h3">
<h3>Starting and Stopping</h3>
</div>
            
<div class="h4">
<h4>Using Scripts</h4>
</div>
                
<p>
                  You can start Phoenix with the following command:

                    <span class="codefrag">

                    &gt; bin/run.[bat|sh]

                    </span>

                
</p>
                
<p>
                  In Windows versions other than NT, you'll need to set
                  the PHOENIX_HOME environment variable first.
                </p>
                
<p>
                  In UNIX environments, you can use the <span class="codefrag">phoenix.sh</span>
                  script to stop Phoenix.
                </p>

                    
<pre class="code">
                      &gt; phoenix.sh stop
                    </pre>

                
<p>
                  phoenix.sh accepts these commands:
                  start, stop, run, restart, check.
                </p>
                
<p>
                  In Windows, typing CONTROL-C will cause a clean shutdown.
                </p>
            
            
<div class="h4">
<h4>Using the Java Service Wrapper</h4>
</div>
              
<p>
                Another option for starting and stopping Phoenix is to build
                it with support for the
                <a href="http://wrapper.tanukisoftware.org/">Java Service Wrapper</a>.
              </p>
              
<p>
                The main benifit of using the Java Service Wrapper is that it can
                install Phoenix as an NT service.  It can also detect if the JVM
                freezes up or crashes and restart the application immediately.
              </p>
              
<p>
                To build Phoenix with the Java Service Wrapper, download and
                extract the latest version.  Next, in the root of the source tree,
                create or modify <span class="codefrag">ant.properties</span> so that it looks
                similar to this:
              </p>


<pre class="code">
# ${base.path} points to the root of the Phoenix source tree
wrapper.home=${base.path}/wrapper_linux_3.0.0
wrapper.jar=${wrapper.home}/lib/wrapper.jar

# If you're using Linux/Solaris:
wrapper.exe=${wrapper.home}/bin/wrapper
wrapper.dll=${wrapper.home}/lib/libwrapper.so

# If you're using Windows:
wrapper.exe=${wrapper.home}/bin/Wrapper.exe
wrapper.dll=${wrapper.home}/lib/Wrapper.dll
</pre>

              
<p>
                Then just build as usual.
              </p>
              
<p>
                For usage instructions, move to the <span class="codefrag">bin</span> directory and type
              </p>

                    
<pre class="code">

                      &gt; wrapper

                    </pre>

              
<p>
                The Wrapper configuration file is named <span class="codefrag">conf/wrapper.conf</span>.
              </p>
            
        
        
<div class="h3">
<h3>Using JMX</h3>
</div>
            
<div class="h4">
<h4>JMX Overview</h4>
</div>
              
<p>
                Phoenix is tightly integrated with Java Management Extensions (JMX).
                TODO: say something else.  Integrate this section with the other
                <a href="mx/index.html">JMX info</a>.
              </p>
            
            
<div class="h4">
<h4>How to Make Your Block an MBean</h4>
</div>
              
<p>
                It's actually quite simple.  Suppose you wanted to expose the
                interface from the WebServer block
                <a href="bdg/making-phoenix-compatible-comps.html">described</a> in
                the Block developer's guide.  You only need to do two things.
              </p>
              
<p>
                First, create an MBean interface.  It will look something like this:
              </p>

<pre class="code">
package examplecomp.block;

public interface WebServerMBean {
    void mountWar(String contextName, URL pathToWar);
    void unMountWar(String contextName);
}
</pre>
              
<p>
                Notice that interface MBean is identical to interface WebServer.
                In most cases, it should be.
              </p>
              
<p>
                Now just make WebServerBlock implement WebServerMBean
              </p>

<pre class="code">
package examplecomp.block;

/**
 * TODO: describe PhoenixXDoclet setup.
 * @phoenix:mx name="examplecomp.block.WebServerMBean"
 */
public class WebServerBlock
    extends AbstractLoggable
    implements WebServer, WebServerMBean, Startable, Configurable, Initializable {

    // ...

}
</pre>
            
            
<div class="h4">
<h4>Using Http Adaptor</h4>
</div>
              
<p>
                The MX4J Http Adaptor allows access to a running Phoenix server
                with any web browser.
              </p>
              
<p>
                TODO: describe configuration methods when they settle down
              </p>
              
<p>
                Then just point your browser to
                <a href="http://localhost:8082/">http://localhost:8082/</a>.
                You should see a list of JMX MBeans you can control.
              </p>
              
<p>
                Under the section labled "Domain: Phoenix" you should see
                a familier looking name or two.  They depend on the .sar
                file packaging and configuration, but the web server above
                would have a name similar to
  <span class="codefrag">Phoenix:application=webserver,block=webserver,topic=WebServerMBean</span>.
                If you click on the name, you'll find a form that allows you
                to mount and unmount .war files through the web!
              </p>
              
<p>
                If your aren't familiar with the guts of Phoenix, you may
                want to browse the source to understand what some of the other
                MBeans listed do. For example,
                <span class="codefrag">Phoenix:component=Embeddor,topic=Embeddor</span> allows
                you to restart and shutdown Phoenix.  It also provides information,
                such as the server's start time and uptime, home directory, version,
                and build information.
              </p>
            
            
<div class="h4">
<h4>Using RMI Adaptor</h4>
</div>
              
<p>
                If you would like to write an agent that can administrate Phoenix
                programatically, you can use the MX4J RMI Adaptor.  This section
                is basically duplicating information available in the MX4J
                <a href="http://mx4j.sourceforge.net/docs/bk01ch03s13.html#d0e1012">
                documentation</a>.  Phoenix uses the JRMP RMI Adaptor.
              </p>
              
<p>
                Ensure that the MX4J RMI Adaptor is enabled in kernel.xml
              </p>

<pre class="code">
        &lt;component role="org.apache.avalon.phoenix.interfaces.SystemManager"
            class="org.apache.avalon.phoenix.components.manager.MX4JSystemManager"
            logger="manager" &gt;
          &lt;enable-rmi-adaptor&gt;true&lt;/enable-rmi-adaptor&gt;
          [other enabled adaptors]
        &lt;/component&gt;

</pre>
              
<p>
                Place mx4j-jmx.jar, mx4j-tools.jar, and jndi.properties (TODO: include it)
                in your classpath.  Suppose you wanted to shut down Phoenix.  Create the
                following class:
              </p>


<pre class="code">
import mx4j.connector.rmi.jrmp.JRMPConnector;
import mx4j.connector.RemoteMBeanServer;
import javax.management.ObjectName;

public class JrmpShutdown {

    public static void main(String[] args) throws Exception
    {
        // Create a JRMPConnector
        JRMPConnector connector = new JRMPConnector();

        // Pass in the adaptor's JNDI name, no properties
        String jndiName = "jrmp";
        connector.connect(jndiName, null);

        // Get the remote MBeanServer from the connector
        // And use it as if it is an MBeanServer
        RemoteMBeanServer server = connector.getRemoteMBeanServer();

        ObjectName objName = new ObjectName("Phoenix:component=Embeddor,topic=Embeddor");
        server.invoke(objName, "shutdown", new Object[0], new String[0]);
    }
}
</pre>
              
<p>
                Compile and run -- presto! The server stops.
              </p>
            
        
        
<div class="h3">
<h3>Troubleshooting</h3>
</div>
          
<p>
            
<strong>Phoenix stops immediatly after starting, with no error message</strong>
          
</p>
          
<p>
            Make sure you have a .sar file in the app/ directory.  If there isn't
            a service running, Phoenix quits immediately.  You can actually
            stop the server by undeploying all registered applications through
            JMX (although that would be a strange way of doing it).
            TODO: is this behavior a good thing?
          </p>
        
    

<div id="authors" align="right">by&nbsp;David W.</div>
</div>
</div>
</div>
</td>
<!--================= end Content ==================-->
</tr>
</tbody>
</table>
<!--================= end Main ==================-->
<!--================= start Footer ==================-->
<div id="footer">
<table summary="footer" cellspacing="0" cellpadding="4" width="100%" border="0">
<tbody>
<tr>
<!--================= start Copyright ==================-->
<td colspan="2">
<div align="center">
<div class="copyright">
              Copyright &copy; 2002-2003&nbsp;The Apache Software Foundation.. All rights reserved.
            </div>
</div>
</td>
<!--================= end Copyright ==================-->
</tr>
<tr>
<td align="left">
<!--================= start Host ==================-->
<!--================= end Host ==================--></td><td align="right">
<!--================= start Credits ==================-->
<div align="right">
<div class="credit"></div>
</div>
<!--================= end Credits ==================-->
</td>
</tr>
</tbody>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
