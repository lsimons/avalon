
  

  
  

  
  

  

  
  

  
  

  
  

  

  

  

  

  

  
  
  
  
      
  

      
      
      
      
      
      
        
         
      
      

      
      
      
      

      
      
      

      

  
  

  
  

   
   


    
	
	

    
    
      
	
	
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

    <html>
      <head>
        
        
          <title>
            Merlin - 
          
        
          </title>
        
        
        
        <style type="text/css">
          @import url("../../style/tigris.css");
          @import url("../../style/maven.css");
        </style>
        
        
        
        
        
        <link rel="stylesheet" href="../../style/print.css" type="text/css" media="print"></link>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta>
        
        
        
        
      </head>

      <body class="composite">

        <div id="banner">
          <table height="103" border="0" width="100%" cellpadding="8" cellspacing="0">
            <tr>
              
              <td>
                
                
                  
                  
                  
                    
                  
                  
                  
                  
                  
                  <a href="http://avalon.apache.org/">
                    <img border="0" alt="The Apache Software Foundation" src="http://avalon.apache.org/images/apache-avalon-logo.png" align="left"></img>
                  </a>
                
              </td>

              <td></td>
              

            </tr>
          </table>
        </div>
        <div id="breadcrumbs">
          <table border="0" width="100%" cellpadding="4" cellspacing="0">
            <tr>
              
              <td>
                <div align="right">
                  
                  
                  
                    
    
    
      
      
      
      <a href="http://apache.org/">Apache</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/">Avalon</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/framework/">Framework</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/containers/">Merlin</a>
      
    
      |
      
      
      <a href="http://avalon.apache.org/product/components/">Planet</a>
      
    
  
                  
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <table border="0" width="100%" cellpadding="8" cellspacing="0"> 
          <tr valign="top">
            <td width="20%" id="leftcol">
              <div id="navcolumn">
                

                
                  
    <div>
      <strong>About Merlin</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../about/index.html">Overview</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/index.html">Getting Started</a>
      	
      </small>
	  
        
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/installation/index.html">Installation</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/tutorial/index.html">Using Merlin</a>
      	
      </small>
	  
        
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/tutorial/creation.html">Hello Block</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/tutorial/execution.html">Running Hello</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      		<b><a href="../../starting/tutorial/internal.html">Behind the Scenes</a></b>
      	
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/tutorial/config/index.html">Configurations</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/tutorial/context/index.html">Contextualization</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/tutorial/services.html">Services</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/tutorial/dependencies/index.html">Dependencies</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../starting/advanced/index.html">Advanced Features</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../merlin/index.html">Merlin System</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../extensions/index.html">Extensions</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../tools/index.html">Tools</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
    <div>
      <strong>Resources</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../api/index.html">Javadoc</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../reference/index.html">Specification</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../resources/download.html">Download</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../resources/roadmap/index.html">Roadmap</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="../../dpml/index.html">DPML</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
    <div>
      <strong>Related Projects</strong>
      
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/meta">Meta</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/util">Utilities</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    

    <div>
      <small>
      	
      	
      		<a href="http://avalon.apache.org/repository">Repository</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
                
                
                
                

                
                
                <div>
                  <strong>Project Documentation</strong>
                  
                  <div>
                    <small>
                      <a href="../../project-info.html">Project Info</a>
                    </small>
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                  </div>
                  <div>
                    <small>
                      <a href="../../maven-reports.html">Project Reports</a>
                    </small>
                    
					
                    
                    
                      
                      
                    
                      
                      
                    
                    
                    
                    
                  </div>
                  
                    
                  
                  
                </div>
              
              
                
                
                
                
              
                
              </div>
            </td>
            <td rowspan="2">
              <div id="bodycol">
                
                <div class="app">
                  
                  
    <div class="h3">
      
      
        <h3>
          <a name="Using Merlin">Using Merlin</a>
        </h3>
      
      
    <div class="h4">
      
      
        <h4>
          <a name="Behind the Scenes -info">Behind the Scenes -info</a>
        </h4>
      
      
    <p>
      
        To get a better understanding of what is happening we can ask Merlin
        to present a summary of the source information and resources used
        in our component deployment scenario by including the -info command line 
        modifier.  
        
    </p>
   
    <div id="source">
      <pre>
$ merlin -execute target\classes -info

  Version: Merlin SMP 3.0
  Environment: Windows NT 4.0 Java 1.4.2
  Deployment Home: ${user.dir}/home
  Runtime Repository: F:\system\maven
  Library Anchor: ${user.dir}
  Kernel Path: resource:/kernel.xml
  Deployment Blocks: file:/${user.dir}/target/classes/
  Override Path:
  Server Flag: false
  Debug Flag: true

[INFO   ] (tutorial.hello): logging
[INFO   ] (tutorial.hello): initialization
[INFO   ] (tutorial.hello): execution
[INFO   ] (tutorial.hello): disposal
</pre>
    </div>
  
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Targetted debugging using -config">Targetted debugging using -config</a>
        </h4>
      
      
    <p>
      
        We can also override the logging priority for the component using 
        a target override directive.
        
    </p>
   
    <p>
      
    <i>
      ${basedir}\conf\config.xml
    </i>
   
    </p>
   
    <div id="source">
      <pre>
&lt;targets&gt;
  &lt;target path="/tutorial/hello"&gt;
    &lt;categories priority="DEBUG"/&gt;
  &lt;/target&gt;
&lt;/targets&gt;
</pre>
    </div>
  
    <p>
      
        The behind the scenes activity is 
        detailed under the &lt;component-path&gt;.appliance logging category 
        as shown below.
        
    </p>
   
    <div id="source">
      <pre>
$ merlin -execute target\classes -config conf\config.xml

[DEBUG  ] (tutorial.hello.appliance): assembly phase
[DEBUG  ] (tutorial.hello.appliance): deployment (transient) [true]
[DEBUG  ] (tutorial.hello.appliance): new instance: 24531886
[DEBUG  ] (tutorial.hello.appliance): applying logger to: 24531886
[INFO   ] (tutorial.hello): logging
[DEBUG  ] (tutorial.hello.appliance): applying initialization to: 24531886
[INFO   ] (tutorial.hello): initialization
[DEBUG  ] (tutorial.hello.appliance): executing: 24531886
[INFO   ] (tutorial.hello): execution
[DEBUG  ] (tutorial.hello.appliance): component established: 24531886
[DEBUG  ] (tutorial.hello.appliance): activated instance: 24531886
[DEBUG  ] (tutorial.hello.appliance): decommissioning phase
[DEBUG  ] (tutorial.hello.appliance): component disposal: 24531886
[DEBUG  ] (tutorial.hello.appliance): disposing of: 24531886
[INFO   ] (tutorial.hello): disposal
[DEBUG  ] (tutorial.hello.appliance): destroyed instance: 24531886
[DEBUG  ] (tutorial.hello.appliance): dissassembly phase
[DEBUG  ] (tutorial.hello.appliance): disposal
</pre>
    </div>
  
    <p>
      
        The following information presents the above listing step by step.
        
    </p>
   
    <p>
      
        Launch merlin in execute mode using the "target\classes" directory
        as an implicit classpath entry and a deployment scenario defined in
        the file target\classes\BLOCK-INF\block.xml.
        
    </p>
   
    <div id="source">
      <pre>
$ merlin -execute target\classes -config conf\config.xml
</pre>
    </div>
  
    <p>
      
        The assembly phase checks the component for any service dependencies
        and reolves them automatically.  In our demonstration component there 
        are not dependencies.  Later tutorials will revisit this aspect.
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): assembly phase
</pre>
    </div>
  
    <p>
      
        As the compoent has been declared in the block.xml file, the default
        deployment policy is to deploy it on startup.  In this example the 
        component is a transient component.  The logging message details
        the lifestyle and policy during activation on startup.
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): deployment (transient) [true]
</pre>
    </div>
  
    <p>
      
        Deployment commences with the initialization of a new instance.
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): new instance: 24531886
</pre>
    </div>
  
    <p>
      
        A logger is assigned because the component implements the 
        LogEnabled interface.  
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): applying logger to: 24531886
[INFO   ] (tutorial.hello): logging
</pre>
    </div>
  
    <p>
      
        A component is initialized because it implements the 
        Initializable interface.
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): applying initialization to: 24531886
[INFO   ] (tutorial.hello): initialization
</pre>
    </div>
  
    <p>
      
        If the component implemeted the Startable interface it would be 
        started at this point.  If it dowes not implement Startable, 
        Merlin will check to see if it implements Executable and if so, the 
        container invokes execute on the component.
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): executing: 24531886
[INFO   ] (tutorial.hello): execution
[DEBUG  ] (tutorial.hello.appliance): component established: 24531886
[DEBUG  ] (tutorial.hello.appliance): activated instance: 24531886
</pre>
    </div>
  
    <p>
      
        When merlin is launched in execute mode (using the -execute command
        line parameter), Merlin automatically initiates container decomissioning
        once deployment is complete.  If the -execute parameter is absent, Merlin 
        will continue until a ^C interup is encountered.
        
    </p>
   
    <p>
      
        Decommissioning of a component involves stopping the compoent if it 
        implements the Startable interface, followed by component disposal.
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): decommissioning phase
[DEBUG  ] (tutorial.hello.appliance): component disposal: 24531886
[DEBUG  ] (tutorial.hello.appliance): disposing of: 24531886
[INFO   ] (tutorial.hello): disposal
[DEBUG  ] (tutorial.hello.appliance): destroyed instance: 24531886
</pre>
    </div>
  
    <p>
      
        Internally the appliance instance managing the deployment scenario
        is taken down during which it is dissassembled and disposed of.
        
    </p>
   
    <div id="source">
      <pre>
[DEBUG  ] (tutorial.hello.appliance): dissassembly phase
[DEBUG  ] (tutorial.hello.appliance): disposal
</pre>
    </div>
  
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="The -debug command line switch">The -debug command line switch</a>
        </h4>
      
      
    <p>
      
      For a really deep look inside Merlin, you can select the -debug command
      line switch.  Some of the addition information visible here includes the 
      setup of classloaders
      
    </p>
   
    <div id="source">
      <pre>
$ merlin -execute target\classes -debug

[DEBUG  ] (kernel.logging): default priority: DEBUG
[DEBUG  ] (kernel.logging): adding category: kernel, null
[DEBUG  ] (kernel.context): logging system established
[DEBUG  ] (kernel.context): using bootstrap repository
[DEBUG  ] (kernel.logging): adding category: kernel, null
[DEBUG  ] (kernel.context): model factory established
[DEBUG  ] (kernel): creating root containment context
[DEBUG  ] (kernel.classloader): base: ${user.dir}
[DEBUG  ] (kernel.classloader): classpath:
[DEBUG  ] (kernel.classloader.types): type install count: 0
[DEBUG  ] (kernel): construction phase
[DEBUG  ] (kernel): install phase
[INFO   ] (kernel): installing: file:/${user.dir}/target/classes/
[DEBUG  ] (kernel): installing: tutorial
[DEBUG  ] (kernel.tutorial.classloader): base: ${user.dir}
[DEBUG  ] (kernel.tutorial): implicit entries: 1
[DEBUG  ] (kernel.tutorial): repository declarations: 1
[DEBUG  ] (kernel.tutorial): repository 0 contains 1 entries.
[DEBUG  ] (kernel.tutorial.classloader): classpath: 
  file:/${user.dir}/target/classes/;
  file:/${merlin.home}/repository/avalon-framework/jars/
    avalon-framework-impl-SNAPSHOT.jar
[DEBUG  ] (kernel.tutorial.classloader.scanner): scanning: 
file:/${user.dir}/target/classes/
[DEBUG  ] (kernel.tutorial.classloader.scanner): type: tutorial.HelloComponent
[DEBUG  ] (kernel.tutorial.classloader.scanner): scanning: 
  file:/${merlin.home}/repository/avalon-framework/
jars/avalon-framework-impl-SNAPSHOT.jar
[DEBUG  ] (kernel.tutorial.classloader.types): type install count: 1
[DEBUG  ] (kernel.tutorial.classloader.types): registered 
  [type:tutorial.HelloComponent/1].
[DEBUG  ] (kernel.tutorial): installing: hello
[DEBUG  ] (kernel): customization phase
[DEBUG  ] (kernel): composition phase
[DEBUG  ] (kernel.logging): adding category: , null
[DEBUG  ] (): creating block: /tutorial
[DEBUG  ] (kernel.logging): adding category: tutorial, null
[DEBUG  ] (tutorial): creating appliance: /tutorial/hello
[DEBUG  ] (kernel.logging): adding category: tutorial.hello, null
[DEBUG  ] (kernel): assembly phase
[DEBUG  ] (): assembly phase
[DEBUG  ] (tutorial): assembly phase
[DEBUG  ] (tutorial.hello.appliance): assembly phase
[DEBUG  ] (kernel): deployment phase
[DEBUG  ] (): deployment: block:/tutorial
[DEBUG  ] (tutorial): deployment: appliance:/tutorial/hello
[DEBUG  ] (tutorial.hello.appliance): deployment (transient) [true]
[DEBUG  ] (tutorial.hello.appliance): new instance: 10040639
[DEBUG  ] (tutorial.hello.appliance): applying logger to: 10040639
[INFO   ] (tutorial.hello): logging
[DEBUG  ] (tutorial.hello.appliance): applying initialization to: 10040639
[INFO   ] (tutorial.hello): initialization
[DEBUG  ] (tutorial.hello.appliance): executing: 10040639
[INFO   ] (tutorial.hello): execution
[DEBUG  ] (tutorial.hello.appliance): component established: 10040639
[DEBUG  ] (tutorial.hello.appliance): activated instance: 10040639
[INFO   ] (kernel): decommissioning phase
[DEBUG  ] (): decommissioning: block:/tutorial
[DEBUG  ] (tutorial): decommissioning: appliance:/tutorial/hello
[DEBUG  ] (tutorial.hello.appliance): decommissioning phase
[DEBUG  ] (tutorial.hello.appliance): component disposal: 10040639
[DEBUG  ] (tutorial.hello.appliance): disposing of: 10040639
[INFO   ] (tutorial.hello): disposal
[DEBUG  ] (tutorial.hello.appliance): destroyed instance: 10040639
[INFO   ] (kernel): dissassembly phase
[DEBUG  ] (): dissassembly phase
[DEBUG  ] (tutorial): dissassembly phase
[DEBUG  ] (tutorial.hello.appliance): dissassembly phase
[INFO   ] (kernel): disposal phase
[DEBUG  ] (): disposal phase
[DEBUG  ] (tutorial): disposal phase
[DEBUG  ] (tutorial.hello.appliance): disposal
[INFO   ] (kernel): bye (1)
</pre>
    </div>
  
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="Next Steps">Next Steps</a>
        </h4>
      
      
    <p>
      
      We are now ready to move onto the next series of tutorials dealing 
      with 
    <a href="config/index.html">component configuration management</a>
  .
      
    </p>
   
    </div>
  
    </div>
  
                  
                  
                  
                  
                  
                </div>
              </div>
            </td>
          </tr>
        </table>
        <div id="footer">
          <table border="0" style="width:100%" cellpadding="4" cellspacing="0">
            
            <tr>
              <td>
                
                  
                    
                    
                      © 1997-2004, The Apache Software Foundation
                    
                  
                  
                

                
              </td>
              
            </tr>
          </table>
        </div>
      </body>
    </html>
  