<project default="do-install" xmlns:maven="jelly:maven" xmlns:j="jelly:core" xmlns:util="jelly:util">
    
    <property file="${basedir}/../build.properties"/>
    <property file="${basedir}/../project.properties"/>
    <property file="project.properties"/>
    <property name="maven.jar.manifest.extensions.add" value="true"/>
    <property name="maven.checkstyle.format" value="avalon"/>
    <property name="pom.organization.identifier" value="ASF"/>
    <property name="pom.specificationVersion" value="1.0"/>
    
    <goal name="wrapper">
        <echo message="${maven.build.dest}"/>
        <taskdef name="attributes"
            classname="org.apache.avalon.attributes.compiler.AttributeCompiler">
            <classpath>
                <path refid="maven.dependency.classpath"/>
            </classpath>
        </taskdef>
        
        <!-- Set up the classloader tests -->
        <attributes destDir="target/cl1/">
            <fileset dir="src/cl1/" includes="**/*.java"/>
        </attributes>
        <attributes destDir="target/cl2/">
            <fileset dir="src/cl2/" includes="**/*.java"/>
        </attributes>
        <javac destdir="target/cl1/"
            debug="true"
            deprecation="true">
            <src> 
                <pathelement path="target/cl1/"/>
                <pathelement path="src/cl1/"/>
                <pathelement path="src/java/"/>
            </src>
            <classpath>
                <path refid="maven.dependency.classpath"/>
                <pathelement path="target/cl1/"/>
            </classpath>
        </javac>
        <javac destdir="target/cl2/"
            classpath="target/cl2/"
            debug="true"
            deprecation="true">
            <src> 
                <pathelement path="target/cl2/"/>
                <pathelement path="src/cl2/"/>
                <pathelement path="src/java/"/>
            </src>
            <classpath>
                <path refid="maven.dependency.classpath"/>
                <pathelement path="target/cl1/"/>
            </classpath>
        </javac>
        
        <taskdef name="attributes-index"
            classname="org.apache.avalon.attributes.compiler.AttributeIndexer">
            <classpath>
                <path refid="maven.dependency.classpath"/>
            </classpath>
        </taskdef>
        
        <jar jarfile="target/cl2/cl2.jar">
            <fileset dir="target/cl2/" includes="**/*.class"/>
            <fileset dir="target/cl2/" includes="META-INF/**/*"/>
        </jar>        
        
        <attributes-index jarFile="target/cl2/cl2.jar">
            <classpath>
                <path refid="maven.dependency.classpath"/>
            </classpath>
        </attributes-index>
        
        <!-- Create the Attribute Repository Classes. -->
        <attributes destDir="target/temp/">
            <fileset dir="src/test/" includes="**/*.java"/>
        </attributes>
        <copy todir="target/temp/">
            <fileset dir="src/test/" includes="**/*.java"/>
        </copy>
        
        <attainGoal name="jar:install-snapshot"/>
    </goal>
</project>
