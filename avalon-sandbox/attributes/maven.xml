<project default="do-install" xmlns:maven="jelly:maven" xmlns:j="jelly:core" xmlns:util="jelly:util">
    
    <property file="${basedir}/../build.properties"/>
    <property file="${basedir}/../project.properties"/>
    <property file="project.properties"/>
    <property name="maven.jar.manifest.extensions.add" value="true"/>
    <property name="maven.checkstyle.format" value="avalon"/>
    <property name="pom.organization.identifier" value="ASF"/>
    <property name="pom.specificationVersion" value="1.0"/>
    
    <goal name="do-install" 
        description="Build the Avalon Attributes distribution." >
        <maven:reactor
            basedir="${basedir}"
            includes="api/project.xml"
            goals="jar:install-snapshot"
            banner="Building:"
            ignoreFailures="false" />
        
        <maven:reactor
            basedir="${basedir}"
            includes="compiler/project.xml"
            goals="jar:install-snapshot"
            banner="Building:"
            ignoreFailures="false" />
        
        <maven:reactor
            basedir="${basedir}"
            includes="unittest/project.xml"
            goals="wrapper"
            banner="Building:"
            ignoreFailures="false" />
        
        
    </goal>
    
    <goal name="do-clean" prereqs="clean">
        <maven:reactor
            basedir="${basedir}"
            includes="*/project.xml"
            excludes="site/*"
            goals="clean:clean"
            banner="Cleaning subproject:"
            ignoreFailures="false"/>
    </goal>
    
    <goal name="do-site">
        <maven:reactor
            basedir="${basedir}"
            includes="site/project.xml"
            goals="license,xjavadoc,site"
            banner="Building Site:"
            ignoreFailures="false" />
    </goal>
    
    <goal name="xjavadoc">
        <mkdir dir="${basedir}/target/docs/api" />
        <property name="copyright"
            value="Copyright &amp;copy; ${year} ${pom.organization.name}. All Rights Reserved." />
        <property name="title" value="${pom.name} ${pom.currentVersion} API"/>
        <javadoc destdir="${basedir}/target/docs/api" 
            doctitle="&lt;h1&gt;Avalon Attributes&lt;/h1&gt;" 
            noindex="false" author="true" use="true"
            windowtitle="${title}" 
            bottom="${copyright}"
            additionalparam="-breakiterator -J-Xmx128m "
            packagenames="*,org.*"
            overview="${basedir}/../api/src/java/overview.html">
            <j:forEach var="packageGroup" items="${pom.packageGroups}">
                <group title="${packageGroup.title}" packages="${packageGroup.packages}"/>
            </j:forEach>
            <sourcepath path="${basedir}/../api/src/java"/>
            <sourcepath path="${basedir}/../compiler/src/java"/>
            <classpath>
                <path refid="maven.dependency.classpath"/>
            </classpath>
            <link href="${sun.j2se.link}" />
            <link href="${avalon.framework.link}" />
        </javadoc>
    </goal>
    
</project>
