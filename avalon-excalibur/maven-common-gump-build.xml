<?xml version="1.0"?>

<!-- this ant buildfile provides base functionality for gump
     integration. You should not normally have to modify this
     by hand. -->
<project name="Gump Build Support" default="warning" basedir=".">
    <!-- note the lack of property file inclusion. You should
         do that from the script which calls this file. -->

    <target name="excalibur:warn-project.name" unless="project.name.set">
        <echo>
=======================================================================
                          WARNING!

  The property 'project.name' has not been set. This will result in a
  jar file with a rather dumb name, being

  ${maven.build.dir}/${project.name}-${project.version}.jar

  To fix this, add a property to the gump build definition or the
  properties file for the current component.
=======================================================================
        </echo>
    </target>

    <target name="excalibur:init">
        <condition property="project.name.set">
            <isset property="project.name"/>
        </condition>
        <antcall target="excalibur:warn-project.name"/>

        <!-- defaults -->
        <property name="maven.src.dir" value="${basedir}/src"/>
        <property name="maven.build.dir" value="${basedir}/target"/>
        <property name="maven.compile.debug" value="on"/>
        <property name="maven.compile.optimize" value="off"/>
        <property name="maven.compile.deprecation" value="off"/>
        <property name="maven.junit.fork" value="off"/>
        <property name="maven.junit.dir" value="${basedir}"/>
        <property name="maven.junit.usefile" value="true"/>

        <property name="project.name" value="some-nameless-gump-built-component"/>
        <tstamp>
            <format property="project.version" pattern="yyyyMMdd"/>
        </tstamp>
        <property name="project.copyright.year" value="1997-2003"/>
    </target>

    <target name="excalibur:debug" depends="excalibur:init" unless="do.not.debug">
        <echo>
=======================================================================
DEBUG INFO

  maven.src.dir             = ${maven.src.dir}
  maven.build.dir           = ${maven.build.dir}
  maven.compile.debug       = ${maven.compile.debug}
  maven.compile.deprecation = ${maven.compile.deprecation}
  maven.compile.optimize    = ${maven.compile.optimize}

  project.name              = ${project.name}
  project.version           = ${project.version}
  project.copyright.year    = ${project.copyright.year}

  java sources = ${maven.src.dir}/java
  java classes = ${maven.build.dir}/classes
  jarfile      = ${maven.build.dir}/${project.name}-${project.version}.jar
  javadocs     = ${maven.build.dir}/docs/apidocs
=======================================================================
        </echo>
    </target>

    <target name="excalibur:warning" depends="excalibur:init,excalibur:debug" unless="do.not.warn">
        <echo>
=======================================================================
                          WARNING!

  This buildfile is only here for gump integration. Please use
  maven (http://maven.apache.org/) for normal builds.
=======================================================================
        </echo>
    </target>

    <target name="excalibur:jar" depends="excalibur:init,excalibur:warning">
        <echo>
=======================================================================
 Compiling Sources
=======================================================================
        </echo>
        <mkdir dir="${maven.build.dir}"/>
        <mkdir dir="${maven.build.dir}/classes"/>
        <javac
                destdir="${maven.build.dir}/classes"
                excludes="**/package.html"
                debug="${maven.compile.debug}"
                deprecation="${maven.compile.deprecation}"
                optimize="${maven.compile.optimize}">

            <src>
                <pathelement path="${maven.src.dir}"/>
            </src>
        </javac>

        <echo>
=======================================================================
 Compiling Tests
======================================================================
        </echo>
        <mkdir dir="${maven.build.dir}/test-classes"/>
        <javac
                destdir="${maven.build.dir}/test-classes"
                excludes="**/package.html"
                debug="${maven.compile.debug}"
                deprecation="${maven.compile.deprecation}"
                optimize="${maven.compile.optimize}">

            <src>
                <pathelement path="${maven.src.dir}/test"/>
            </src>
            <classpath>
              <pathelement path="${maven.build.dir}/classes"/>
            </classpath>
        </javac>

        <echo>
=======================================================================
 Running tests
=======================================================================
        </echo>
        <taskdef
          name="junit"
          classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask"/>

        <mkdir dir="${maven.build.dir}/test-reports"/>

        <junit printSummary="yes"
               failureProperty="maven.test.failure"
               fork="${maven.junit.fork}"
               dir="${maven.junit.dir}">
          <sysproperty key="basedir" value="${basedir}"/>

          <formatter type="xml"/>
          <formatter type="plain" usefile="${maven.junit.usefile}"/>
          <classpath>
            <pathelement location="${maven.build.dir}/classes"/>
            <pathelement location="${maven.build.dir}/test-classes"/>
          </classpath>
          <batchtest todir="${maven.build.dir}/test-classes">
            <fileset dir="${maven.src.dir}/test">
                <include name="**/*TestCase.java"/>
                <!-- KEEP ALL ABSTRACT TESTS FROM BEING RUN! -->
                <exclude name="**/*Abstract*"/>
            </fileset>
          </batchtest>
        </junit>

        <echo>
=======================================================================
 Building jar
=======================================================================
        </echo>
        <jar destfile="${maven.build.dir}/${project.name}-${project.version}.jar" basedir="${maven.build.dir}/classes"/>
    </target>

    <target name="excalibur:javadocs" depends="excalibur:init,excalibur:warning,excalibur:jar">
        <mkdir dir="${maven.build.dir}/docs"/>
        <mkdir dir="${maven.build.dir}/docs/apidocs"/>

        <property name="copyright"
          value="Copyright &amp;copy; ${project.copyright.year} Apache Software Foundation. All Rights Reserved." />

        <property name="title" value="Avalon-Excalibur ${project.name} API"/>

        <javadoc
          sourcepath="${maven.src.dir}/java"
          packagenames="org.apache.*"
          destdir="${maven.build.dir}/docs/apidocs"
          windowtitle="${title}"
          doctitle="${title}"
          bottom="${copyright}">

          <link href="http://java.sun.com/j2se/1.4.1/docs/api/"/>
          <link href="http://avalon.apache.org/framework/api/"/>
          <classpath>
            <path location="${maven.build.dir}/classes"/>
          </classpath>

        </javadoc>
    </target>
</project>