<?xml version="1.0"?>

<!-- maven buildfile customization. -->

<project default="java:jar">

    <!-- ==========================================================
          Warning
         ========================================================== -->

    <preGoal name="java:compile">
        <attainGoal name="excalibur:warn"/>
    </preGoal>
    <postGoal name="jar:jar">
        <attainGoal name="excalibur:warn"/>
    </postGoal>

    <goal name="excalibur:warn"
            description="Alerts the user that the maven build is in development">
        <echo>
            ----------------------------------------------------------------
             Avalon Excalibur Build System, the Maven Edition:
            ----------------------------------------------------------------
                            !!! WARNING !!!

             excalibur is built using ant; the maven build system
             is still in development. *DO NOT USE IT* unless you're helping
             out with setting that up or testing it.
            ----------------------------------------------------------------
        </echo>
    </goal>

    <!-- ==========================================================
          Doc Generation
         ==========================================================

         For now, I've just copy-pasted the relevant snippets from
         the ant build that call forrest. We need a forrest plugin.

         ========================================================== -->

    <postGoal name="xdoc">
        <attainGoal name="forrest:generate"/>
    </postGoal>

    <property file="${user.home}/build.properties"/>
    <property file="${basedir}/../ant.properties"/>
    <property file="${basedir}/ant.properties"/>
    <property file="${user.home}/.ant.properties"/>
    <property file="${basedir}/../libraries.properties"/>
    <property file="${basedir}/../default.properties"/>
    <property file="${basedir}/default.properties"/>

    <goal name="forrest:docs" description="Transforms forrest docs">

        <mkdir dir="${docs.dir}"/>

        <ant antfile="${basedir}/../forrestbuild.xml"/>

        <copy todir="${maven.build.dir}/docs/">
          <fileset dir="${build.docs}">
            <include name="**"/>
          </fileset>
        </copy>

   </goal>

    <!-- ==========================================================
          Cleanup of ant artifacts
         ========================================================== -->

    <postGoal name="clean">
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
    </postGoal>

</project>
