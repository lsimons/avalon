<?xml version="1.0"?>

<project name="Phoenix Docs" default="main" basedir=".">

    <!--
    Give user a chance to override without editing this file
    (and without typing -D each time he compiles it)
    -->
    <property file="ant.properties"/>
    <property file="${user.home}/.ant.properties"/>

    <property name="docs.dir" value="docs"/>
    <property name="xdocs.dir" value="src/xdocs"/>
    <property name="jakarta-site.dir" value="../jakarta-site"/>

    <path id="project.class.path">
                <fileset dir="${jakarta-site.dir}/lib">
                    <include name="*.jar"/>
                </fileset>
    </path>

    <!-- Main target -->
    <target name="main" depends="docs" description="Builds the distribution"/>

    <target name="anakia-avail">
        <available classname="org.apache.velocity.anakia.AnakiaTask"
            property="AnakiaTask.present">
            <classpath refid="project.class.path"/>
        </available>
    </target>

    <target name="anakia-check" depends="anakia-avail" unless="AnakiaTask.present">
        <echo>
            AnakiaTask is not present! Please check to make sure that
            velocity.jar is in your classpath. The easiest way to build
            the documentation is to checkout jakarta-site CVS and specify
            jakarta-site.dir property.
        </echo>
    </target>

    <target name="docs" depends="anakia-check" description="Generate documentation and website">
        <taskdef name="anakia"
            classname="org.apache.velocity.anakia.AnakiaTask">
            <classpath refid="project.class.path"/>
        </taskdef>

        <anakia basedir="${xdocs.dir}"
            destdir="${docs.dir}"
            style="docs.vsl"
            projectfile="stylesheets/project.xml"
            includes="**/*.xml"
            excludes="stylesheets/** history/** changes.xml"
            velocitypropertiesfile="${xdocs.dir}/stylesheets/velocity.properties"
            />

        <anakia basedir="${xdocs.dir}"
            destdir="${docs.dir}"
            style="changes.vsl"
            projectfile="stylesheets/project.xml"
            includes="changes.xml"
            velocitypropertiesfile="${xdocs.dir}/stylesheets/velocity.properties"
            />

     <copy todir="${docs.dir}" filtering="off">
      <fileset dir="${xdocs.dir}">
        <include name="**/images/**"/>
      </fileset>
    </copy>
    </target>

    <!-- Cleans up build and distribution directories -->
    <target name="clean" description="Deletes all built files">
        <delete dir="${docs.dir}"/>
    </target>

</project>
