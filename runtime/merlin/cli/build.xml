<?xml version="1.0" encoding="UTF-8" ?>

<project name="avalon-merlin-cli" default="install" basedir="." 
    xmlns:x="antlib:org.apache.avalon.tools">

  <property file="build.properties"/>
  <import file="${project.home}/build/standard.xml"/>

  <property name="merlin.zip" value="avalon-merlin-3.3.1-DEV.zip"/>

  <target name="init" depends="standard.init">

    <x:path id="runtime" mode="RUNTIME"/>
    <pathconvert targetos="windows" property="windows" refid="runtime"/>
    <filter value="${windows}" token="WINDOWS-CLI-CLASSPATH"/>

    <x:filter key="avalon-merlin-cli" feature="version" 
       token="VERSION"/>
    <x:filter key="avalon-logging-logkit-impl" feature="uri" 
       token="LOGGING_IMPLEMENTATION"/>
    <x:filter key="avalon-merlin-impl" feature="uri" 
       token="MERLIN_IMPLEMENTATION"/>
    <x:filter key="avalon-activation-impl" feature="uri" 
       token="STANDARD_RUNTIME"/>
    <x:filter feature="system-classpath-for-windows" 
       token="WINDOWS-CLI-CLASSPATH"/>
    <x:filter feature="system-classpath-for-unix" 
       token="UNIX-CLI-CLASSPATH"/>
  </target>

  <target name="package" depends="standard.package">

    <x:path id="build.path" mode="BUILD"/>
    <x:replicate refid="build.path" todir="target/system"/>
    <copy todir="target/system/${project.group}/jars">
      <fileset dir="target/deliverables/jars">
        <include name="${project.filename}"/>
      </fileset>
    </copy>

    <mkdir dir="target/deliverables/dist"/>
    <zip zipfile="target/deliverables/dist/${merlin.zip}">
      <zipfileset dir="target/deliverables" prefix="merlin" filemode="755" >
        <include name="bin/merlin"/>
        <include name="bin/merlinx"/>
        <include name="bin/*.sh"/>
      </zipfileset>
      <zipfileset dir="target/deliverables" prefix="merlin">
        <include name="bin/**" />
        <include name="config/**" />
        <include name="lib/**" />
        <exclude name="jars/**"/>
        <exclude name="dist/**"/>
        <exclude name="bin/merlin"/>
        <exclude name="bin/merlinx"/>
        <exclude name="bin/*.sh"/>
      </zipfileset>
      <zipfileset dir="target/system" prefix="merlin/system">
        <include name="**" />
      </zipfileset>
    </zip>

  </target>

  <target name="xxx" depends="info">
    <x:declare/>
  </target>

  <target name="zzz" depends="info">
    <echo>${project.filename}</echo>
  </target>

  <!--
  <target name="xxx" depends="info">
    <x:package root="target/temp" key="avalon-merlin-impl"/>
  </target>
  -->

  <!--
  <target name="xxx" depends="info">
    <x:foreach property="dep" key="avalon-merlin-impl">
    </x:foreach>
  </target>
  -->


</project>
