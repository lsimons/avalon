<?xml version="1.0" encoding="UTF-8" ?>

<project name="avalon-merlin-cli" default="install" basedir="." 
    xmlns:x="antlib:org.apache.avalon.tools">

  <property file="build.properties"/>
  <import file="${project.home}/build/standard.xml"/>

  <target name="init" depends="standard.init">
    <x:filter key="avalon-merlin-cli" feature="version" 
       token="VERSION"/>
    <x:filter key="avalon-logging-logkit-impl" feature="uri" 
       token="LOGGING_IMPLEMENTATION"/>
    <x:filter key="avalon-merlin-impl" feature="uri" 
       token="MERLIN_IMPLEMENTATION"/>
    <x:filter key="avalon-activation-impl" feature="uri" 
       token="STANDARD_RUNTIME"/>
    <x:filter feature="system-classpath-for-windows" 
       token="WINDOWS-CLI-CLASSPATH"/>
    <x:filter feature="system-classpath-for-unix" 
       token="UNIX-CLI-CLASSPATH"/>
  </target>

  <target name="package" depends="standard.package">

    <mkdir dir="target/merlin"/>
    <copy todir="target/merlin">
      <fileset dir="target/build/etc" includes="bin/**"/>
    </copy>
    <mkdir dir="target/merlin/lib"/>
    <mkdir dir="target/merlin/system"/>
    <copy todir="target/merlin/system">
      <fileset dir="${magic.cache}">
        <include name="avalon/**"/>
        <include name="commons-cli/jars/commons-cli-1.0.jar"/>
        <include name="servletapi/jars/servletapi-2.3.jar"/>
        <exclude name="avalon/test/**"/>
        <exclude name="avalon/tools/**"/>
      </fileset>
    </copy>
    <copy todir="target/merlin" file="target/build/etc/merlin.properties.template"/>
    <mkdir dir="target/merlin/config"/>
    <copy todir="target/merlin/config" file="target/build/etc/kernel.xml"/>
  </target>

</project>
