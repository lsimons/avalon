<?xml version="1.0" encoding="UTF-8" ?>

<project name="avalon-merlin-cli" default="install" basedir="." 
    xmlns:x="antlib:org.apache.avalon.tools">

  <property file="build.properties"/>
  <import file="${project.home}/build/standard.xml"/>

  <target name="init" depends="standard.init">
    <filter token="VERSION" value="${project.version}"/>
    <x:filter key="avalon-logging-logkit-impl" feature="uri" 
       token="LOGGING_IMPLEMENTATION"/>
    <x:filter key="avalon-merlin-impl" feature="uri" 
       token="MERLIN_IMPLEMENTATION"/>
    <x:filter key="avalon-activation-impl" feature="uri" 
       token="STANDARD_RUNTIME"/>
    <x:filter feature="classpath" platform="windows" prefix="%MERLIN_SYSTEM%"
       token="WINDOWS-CLI-CLASSPATH"/>
    <x:filter feature="path" platform="windows" 
       token="WINDOWS-CLI-MAIN-PATH"/>
    <x:filter feature="classpath" platform="unix" prefix="$MERLIN_SYSTEM"
       token="UNIX-CLI-CLASSPATH"/>
    <x:filter feature="path" platform="unix"
       token="UNIX-CLI-MAIN-PATH"/>
  </target>

  <target name="package" depends="standard.package">
    <x:path id="build.path" mode="BUILD"/>
    <x:replicate refid="build.path" todir="target/system"/>
    <copy todir="target/system/${project.group}/jars">
      <fileset dir="target/deliverables/jars">
        <include name="${project.filename}"/>
      </fileset>
    </copy>
  </target>

  <target name="package" depends="standard.package">
    <property name="merlin.zip" value="${project.short}.zip"/>
    <mkdir dir="target/deliverables/dist"/>
    <zip zipfile="target/deliverables/dist/${merlin.zip}">
      <zipfileset dir="target/deliverables" prefix="merlin" filemode="755" >
        <include name="bin/merlin"/>
        <include name="bin/merlinx"/>
        <include name="bin/*.sh"/>
      </zipfileset>
      <zipfileset dir="target/deliverables" prefix="merlin">
        <include name="bin/**" />
        <include name="config/**" />
        <include name="lib/**" />
        <exclude name="jars/**"/>
        <exclude name="dist/**"/>
        <exclude name="bin/merlin"/>
        <exclude name="bin/merlinx"/>
        <exclude name="bin/*.sh"/>
      </zipfileset>
      <zipfileset dir="target/system" prefix="merlin/system">
        <include name="**" />
      </zipfileset>
    </zip>
  </target>

</project>
