<project default="jar:install" xmlns:maven="jelly:maven" xmlns:j="jelly:core" xmlns:util="jelly:util" xmlns:ant="jelly:ant">

  <preGoal name="jar:jar">
    <j:forEach var="dep" items="${pom.dependencies}">
      <j:if test="${dep.getType()=='jar'}">
        <j:if test="${dep.getId() != 'avalon-repository:avalon-repository-impl'}">
          <unzip src="${pom.getDependencyPath( dep.getId() )}" 
            dest="${maven.build.dir}/classes">
            <patternset>
              <exclude name="META-INF/**"/>
              <exclude name="*.meta"/>
            </patternset>
          </unzip>
        </j:if>
      </j:if>
    </j:forEach>
  </preGoal>

  <!--
  ###########################################################################
  # Create the avalon.implementation metadata.                              #
  # This contains the information used by the factory to identify the       #
  # the implementation artifact classpath, factory, and whatever else       #
  # we need to include this jar as the implementation strategy.             #
  ###########################################################################
  -->

  <postGoal name="java:compile">

    <j:set var="impl" value="${pom.getDependency('avalon-repository:avalon-repository-impl')}"/>

    <ant:echo file="${maven.build.dir}/classes/avalon.implementation">
#===================================================================#
# Default repository implementation artifact identifier.            #
#===================================================================#

meta.domain = avalon
meta.version = 1.0
avalon.artifact.group = ${impl.groupId}
avalon.artifact.name = ${impl.artifactId}
avalon.artifact.version = ${impl.version}

#
# EOF
#
</ant:echo>
  </postGoal>

</project>
