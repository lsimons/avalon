<project default="avalon:build"  xmlns:maven="jelly:maven" xmlns:j="jelly:core" xmlns:util="jelly:util" xmlns:ant="jelly:ant">

  <!--
  ==============================================================================
  structural properties 
  ==============================================================================
  -->

  <goal name="avalon:clean" prereqs="clean">
    <maven:reactor
      basedir="${basedir}"
      includes="*/project.xml"
      excludes="project.xml"
      goals="clean"
      banner="Cleaning:"
      ignoreFailures="true"/>
  </goal>

  <goal name="avalon:build">
    <maven:reactor basedir="${basedir}"
      includes="*/project.xml"
      excludes="project.xml"
      goals="jar:install"
      banner="Building:"
      ignoreFailures="false"
      postProcessing="true" />

    <ant:copy todir="${maven.build.dir}/jars">
      <j:forEach var="child" items="${reactorProjects}">
        <ant:fileset dir="${child.file.parentFile}/target">
          <ant:include name="${child.artifactId}-${child.currentVersion}.jar"/>
        </ant:fileset>
      </j:forEach>
    </ant:copy>
    <j:forEach var="child" items="${reactorProjects}">
      <j:set var="path" 
          value="${child.artifactId}-${child.currentVersion}.jar"/>
      <checksum file="${maven.build.dir}/jars/${path}" fileext=".md5"/>
      <j:if test="${maven_gpg_exe != null}">
        <ant:exec executable="${maven_gpg_exe}">
          <ant:arg value="-a"/>
          <ant:arg value="--yes"/>
          <ant:arg value="-b"/>
          <ant:arg value="${maven.build.dir}/jars/${path}"/>
        </ant:exec>
      </j:if>
    </j:forEach>
  </goal>

  <goal name="avalon:dist" prereqs="avalon:build"/>
  <goal name="avalon:site" prereqs="avalon:build"/>

</project>
