<?xml version="1.0"?>

<!-- 
 Copyright 2004 Apache Software Foundation
 Licensed  under the  Apache License,  Version 2.0  (the "License");
 you may not use  this file  except in  compliance with the License.
 You may obtain a copy of the License at 
 
   http://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing, software
 distributed  under the  License is distributed on an "AS IS" BASIS,
 WITHOUT  WARRANTIES OR CONDITIONS  OF ANY KIND, either  express  or
 implied.
 
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<document>
  <properties>
    <author email="niclas@apache.org">Niclas Hedhman</author>
    <title>Avalon Logging</title>
  </properties>
  <body>
    <section name="Avalon Log4J Logging Plugin">
      <subsection name="Overview">
        <p>
          The Log4J plugin for Avalon Logging allows for the usage of
          Apache Log4J log system to be driving your Avalon application.
          It is a very thin wrapper to Log4J, introducing a single extra
          method call (non reflected) for the log output methods.
        </p>
        <p>
          Instead of mixing in the Log4J configuration into the rest
          of Avalon configuration files, they remain external and
          are instead referenced. Both XML and Properties files are
          supported, and by giving an optional <strong>update</strong>
          element, the configureAndWatch() method will be used.
        </p>
        <p>
          <strong>NOTE! </strong> &quot;Base Directory&quot;
          (property &quot;avalon.logging.basedir&quot;) is NOT SUPPORTED
          inside any Log4J configuration files, and
          all relative filenames inside the Log4J configuration will
          relative to <strong>user.dir</strong> (current directory).
        </p>
      </subsection>
      <subsection name="XML Specification">
        <table>
          <tr><th>Nested Element</th><th>Description</th></tr>
          <tr>
            <td>src</td>
            <td>
              The filename or URL of the Log4J configuration file. This
              file can either be an XML or a Properties configuration file,
              but MUST end with <strong>&quot;.xml&quot;</strong> if it is
              the former. A relative filename will resolve relative to 
              <strong>Base Directory</strong> (property &quot;avalon.logging.basedir&quot;).
            </td>
          </tr>
          <tr>
            <td>update</td>
            <td>
              The Update Interval. For files, unlike URLs, it is 
              possible for Log4J to check for the file being modified
              externally, and if so reload the configuration. If this
              element is specified and has a positive value, this
              FileWatch feature of Log4J will be used. The time is
              specified in milliseconds.
            </td>
          </tr>
          <tr>
            <td>configuration</td>
            <td>
              If you don't specify a &lt;src&gt; element, you MUST specifiy the
              complete Log4J configuration in this element. That mean that this
              &lt;configuration&gt; element corresponds to the root node of a
              Log4J configuration. See below for an example.
            </td>
          </tr>
        </table>
      </subsection>
      <subsection name="Example - External Reference">
<source><![CDATA[
    <logging>
      <src>conf/log4j.xml</src>
      <!-- Check for Update once every minute. -->
      <update>60000</update>
    </logging>
]]></source>
      </subsection>
      <subsection name="Example - Embedded Configuration">
<source><![CDATA[
<logging>
  <configuration>
    <appender name="FILE" class="org.apache.log4j.FileAppender">
      <param name="BufferedIO" value="true" />
      <param name="File" value="application.log" />

      <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%t %-5p %c{2} - %m%n"/>
      </layout>
    </appender>

    <appender name="STDOUT" class="org.apache.log4j.ConsoleAppender">
      <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%d %-5p [%t] %C{2} (%F:%L) - %m%n"/>
      </layout>
    </appender>

    <category name="org.apache.avalon.merlin.activation">
      <priority value="debug"/>
      <appender-ref ref="STDOUT"/>
    </category>

    <root>
      <priority value="error"/>
      <appender-ref ref="FILE"/>
    </root>
  </configuration>
</logging>
]]></source>
      </subsection>
    </section>
  </body>
</document>


