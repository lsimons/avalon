<project default="jar:install" xmlns:maven="jelly:maven" xmlns:j="jelly:core" xmlns:util="jelly:util" xmlns:ant="jelly:ant">

  <property name="maven.jar.manifest" value="${basedir}/src/etc/project.mf"/>
  <property name="maven.jar.manifest.extensions.add" value="false"/>
  <property file="project.properties"/>

  <preGoal name="jar:jar">
    <maven:snapshot project="${pom}"/>
<ant:echo file="${basedir}/snapshot.properties">
build.signature = ${snapshotSignature}
</ant:echo>
    <unzip src="${pom.getDependencyPath('avalon-repository:avalon-repository-spi')}" 
      dest="${maven.build.dir}/classes"/>
    <unzip src="${pom.getDependencyPath('avalon-repository:avalon-repository-impl')}" 
      dest="${maven.build.dir}/classes"/>
  </preGoal>

  <goal name="build" prereqs="jar:install">
    <ant:property environment="env"/>
    <ant:property name="merlinEnvironment" value="${env.MERLIN_HOME}"/>
    <j:if test="${merlinEnvironment != ''}">
       <ant:property name="merlin.home" value="${merlinEnvironment}"/>
    </j:if>
    <ant:property name="merlin.home" value="${user.home}/.merlin"/>
    <copy toDir="${merlin.home}/bin/lib" file="${maven.build.dir}/${maven.final.name}.jar"/>
  </goal>

</project>
