<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE project [
  <!ENTITY % index SYSTEM "file:index.ent"> %index;
]>

<project 
  default="jar:install" 
  xmlns:maven="jelly:maven" 
  xmlns:j="jelly:core" 
  xmlns:util="jelly:util" 
  xmlns:ant="jelly:ant"
  >
  <ant:property file="${avalon.buildsystem}/project.properties" />

  <ant:property name="pom.specificationVersion" value="&avalon-composition-spec;"/>

  <ant:filter token="AVALON-LOGGING-LOGKIT-SPEC" 
      value="&avalon-logging-logkit-artifact-spec;"/>
  <ant:filter token="MERLIN_IMPLEMENTATION" 
      value="artifact:merlin/merlin-impl#&merlin-impl-version;"/>
  <ant:filter token="LOGGING_IMPLEMENTATION" 
      value="&avalon-logging-logkit-artifact;"/>
  <ant:filter token="STANDARD_RUNTIME" 
      value="&avalon-activation-artifact;"/>
  <ant:filter token="REPOSITORY_MAIN" 
      value="&avalon-repository-artifact;"/>

  <preGoal name="test:test">

    <mkdir dir="${basedir}/target/test/repository/test/jars"/>
    <mkdir dir="${basedir}/target/test/ext"/>
    <mkdir dir="${basedir}/target/test/lib"/>
    <mkdir dir="${basedir}/target/test/conf"/>

    <ant:jar jarfile="${basedir}/target/test/ext/test-a.jar"
      manifest="${basedir}/src/test/etc/a.mf"
      includes="**/testa/*.*" 
      basedir="${basedir}/target/test-classes">
    </ant:jar>

    <ant:jar jarfile="${basedir}/target/test/ext/test-b.jar"
      manifest="${basedir}/src/test/etc/b.mf"
      includes="**/testb/*.*" 
      basedir="${basedir}/target/test-classes">
    </ant:jar>

    <ant:jar jarfile="${basedir}/target/test/lib/test-c.jar"
      manifest="${basedir}/src/test/etc/c.mf"
      includes="**/testc/*.*" 
      basedir="${basedir}/target/test-classes">
    </ant:jar>

    <ant:jar jarfile="${basedir}/target/test/repository/test/jars/test-d.jar"
      manifest="${basedir}/src/test/etc/d.mf"
      includes="**/testd/*.*" 
      basedir="${basedir}/target/test-classes">
    </ant:jar>

    <ant:jar jarfile="${basedir}/target/test/repository/test/jars/test-e.jar"
      manifest="${basedir}/src/test/etc/e.mf"
      includes="**/teste/*.*" 
      basedir="${basedir}/target/test-classes">
    </ant:jar>

    <ant:jar jarfile="${basedir}/target/test/repository/test/jars/includes.jar">
      <zipfileset dir="${basedir}/src/test/conf" prefix="BLOCK-INF/">
        <include name="block.xml"/>
      </zipfileset>
    </ant:jar>

    <ant:delete>
      <fileset dir="${basedir}/target/test-classes">
        <include name="**/testa/*.*"/>
        <include name="**/testb/*.*"/>
        <include name="**/testc/*.*"/>
        <include name="**/testd/*.*"/>
      </fileset>
    </ant:delete>

    <ant:copy toDir="${basedir}/target/test/repository/avalon-framework/jars" 
      file="${pom.getDependencyPath('avalon-framework:avalon-framework-impl')}"/>
    <ant:copy toDir="${basedir}/target/test/ext" 
      file="${pom.getDependencyPath('avalon-framework:avalon-framework-api')}"/>
    <ant:copy toDir="${basedir}/target/test/ext" 
      file="${pom.getDependencyPath('avalon-framework:avalon-framework-impl')}"/>
    <ant:copy toDir="${basedir}/target/test/conf" filtering="true" >
      <fileset dir="${basedir}/src/test/conf"/>
    </ant:copy> 
  </preGoal>
</project>
