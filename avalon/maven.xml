<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE project [
  <!ENTITY % index SYSTEM "file:index.ent"> %index;
]>
<project default="avalon:help" xmlns:maven="jelly:maven" xmlns:j="jelly:core" xmlns:util="jelly:util" xmlns:ant="jelly:ant">

  <goal name="avalon:help">
    <echo>
Top level solution not in place yet - but it's underway.
    </echo>
  </goal>

  <!--
  <goal name="avalon:build" description="Build the Avalon Platform."
    prereqs="xmeta,xutil,xrepo,xlogging,xcomposition,xactivation,xmerlin"/>
  -->

  <goal name="xall">
    <maven:reactor basedir="${basedir}"
      includes="**/project.xml"
      excludes="merlin/project.xml,util/project.xml,meta/project.xml,repository/project.xml,logging/project.xml"
      banner="Building:"
      goals=""
      ignoreFailures="false" 
      postProcessing="false" />
  </goal>

  <goal name="xutil">
    <maven:reactor basedir="${basedir}"
      includes="util/project.xml"
      banner="Building:"
      goals="avalon:build"
      ignoreFailures="false" 
      postProcessing="false" />
  </goal>



  <goal name="xmeta">
    <maven:reactor basedir="meta"
      includes="project.xml"
      banner="Building:"
      goals="avalon:build"
      ignoreFailures="false" 
      postProcessing="false" />
  </goal>

  <!--
  ==============================================================================
  filter resources 
  ==============================================================================
  -->

  <preGoal name="java:jar-resources">
    <ant:filter token="AVALON-LOGGING-LOGKIT-SPEC" 
        value="&avalon-logging-logkit-artifact-spec;"/>
    <ant:filter token="MERLIN_IMPLEMENTATION" 
        value="artifact:merlin/merlin-impl#&merlin-impl-version;"/>
    <ant:filter token="LOGGING_IMPLEMENTATION" 
        value="&avalon-logging-logkit-artifact;"/>
    <ant:filter token="STANDARD_RUNTIME" 
        value="&avalon-activation-artifact;"/>
  </preGoal>

  <postGoal name="java:compile">

    <util:file var="merlinProperties" name="merlin.properties"/>
    <j:if test="${merlinProperties.exists()}">
      <ant:copy 
          file="merlin.properties" 
          toDir="${maven.build.dir}/classes" 
          verbose="yes"
          filtering="on">
        <filterset>
          <filter token="MERLIN_IMPLEMENTATION" value="&merlin-impl-artifact;"/>
          <filter token="LOGGING_IMPLEMENTATION" value="&avalon-logging-logkit-artifact;"/>
          <filter token="STANDARD_RUNTIME" value="&avalon-activation-artifact;"/>
        </filterset>
      </ant:copy>
    </j:if>
  </postGoal>

</project>
